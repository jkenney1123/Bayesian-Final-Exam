<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Kenney">

<title>Bayesian Data Analysis Final Exam</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Bayesian Final Exam_files/libs/clipboard/clipboard.min.js"></script>
<script src="Bayesian Final Exam_files/libs/quarto-html/quarto.js"></script>
<script src="Bayesian Final Exam_files/libs/quarto-html/popper.min.js"></script>
<script src="Bayesian Final Exam_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Bayesian Final Exam_files/libs/quarto-html/anchor.min.js"></script>
<link href="Bayesian Final Exam_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Bayesian Final Exam_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Bayesian Final Exam_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Bayesian Final Exam_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Bayesian Final Exam_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Bayesian Final Exam_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="Bayesian Final Exam_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#problem-1-weibull-model-with-conjugate-prior" id="toc-problem-1-weibull-model-with-conjugate-prior" class="nav-link active" data-scroll-target="#problem-1-weibull-model-with-conjugate-prior"><span class="header-section-number">1</span> Problem 1: Weibull model with conjugate prior</a>
  <ul class="collapse">
  <li><a href="#question-1.1-8-points" id="toc-question-1.1-8-points" class="nav-link" data-scroll-target="#question-1.1-8-points"><span class="header-section-number">1.1</span> Question 1.1 (8 points)</a></li>
  <li><a href="#question-1.2-8-points" id="toc-question-1.2-8-points" class="nav-link" data-scroll-target="#question-1.2-8-points"><span class="header-section-number">1.2</span> Question 1.2 (8 points)</a></li>
  <li><a href="#question-1.3-4-points" id="toc-question-1.3-4-points" class="nav-link" data-scroll-target="#question-1.3-4-points"><span class="header-section-number">1.3</span> Question 1.3 (4 points)</a></li>
  <li><a href="#question-1.4-8-points" id="toc-question-1.4-8-points" class="nav-link" data-scroll-target="#question-1.4-8-points"><span class="header-section-number">1.4</span> Question 1.4 (8 points)</a></li>
  </ul></li>
  <li><a href="#problem-2-change-point-model" id="toc-problem-2-change-point-model" class="nav-link" data-scroll-target="#problem-2-change-point-model"><span class="header-section-number">2</span> Problem 2: Change-point model</a>
  <ul class="collapse">
  <li><a href="#question-2.1-10-points" id="toc-question-2.1-10-points" class="nav-link" data-scroll-target="#question-2.1-10-points"><span class="header-section-number">2.1</span> Question 2.1 (10 points)</a></li>
  <li><a href="#question-2.2-10-points" id="toc-question-2.2-10-points" class="nav-link" data-scroll-target="#question-2.2-10-points"><span class="header-section-number">2.2</span> Question 2.2 (10 points)</a></li>
  <li><a href="#question-2.3-10-points" id="toc-question-2.3-10-points" class="nav-link" data-scroll-target="#question-2.3-10-points"><span class="header-section-number">2.3</span> Question 2.3 (10 points)</a></li>
  <li><a href="#question-2.4-10-points" id="toc-question-2.4-10-points" class="nav-link" data-scroll-target="#question-2.4-10-points"><span class="header-section-number">2.4</span> Question 2.4 (10 points)</a></li>
  </ul></li>
  <li><a href="#problem-3-model-comparison-on-regression-models" id="toc-problem-3-model-comparison-on-regression-models" class="nav-link" data-scroll-target="#problem-3-model-comparison-on-regression-models"><span class="header-section-number">3</span> Problem 3: Model comparison on regression models</a>
  <ul class="collapse">
  <li><a href="#question-3.1-7-points" id="toc-question-3.1-7-points" class="nav-link" data-scroll-target="#question-3.1-7-points"><span class="header-section-number">3.1</span> Question 3.1 (7 points)</a></li>
  <li><a href="#question-3.2-7-points" id="toc-question-3.2-7-points" class="nav-link" data-scroll-target="#question-3.2-7-points"><span class="header-section-number">3.2</span> Question 3.2 (7 points)</a></li>
  <li><a href="#question-3.3-8-points" id="toc-question-3.3-8-points" class="nav-link" data-scroll-target="#question-3.3-8-points"><span class="header-section-number">3.3</span> Question 3.3 (8 points)</a></li>
  <li><a href="#question-3.4-10-points" id="toc-question-3.4-10-points" class="nav-link" data-scroll-target="#question-3.4-10-points"><span class="header-section-number">3.4</span> Question 3.4 (10 points)</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bayesian Data Analysis Final Exam</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John Kenney </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="problem-1-weibull-model-with-conjugate-prior" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Problem 1: Weibull model with conjugate prior</h1>
<p>The Weibull distribution is a distribution that is often used for lifetimes of equipment/parts. It actually has two parameters but for the moment let’s assume that one of them is fixed. The Weibull(2) density is</p>
<span class="math display">\begin{align*}
f(x|\theta) &amp;= 2\theta x \text{exp}(- \theta x^2) \\
\end{align*}</span>
<p>for <span class="math inline">x &gt; 0</span>. The parameter <span class="math inline">\theta</span> is something like the “inverse lifetime” parameter. Large <span class="math inline">\theta</span> means short lifetimes, while small <span class="math inline">\theta</span> means long lifetimes. The mean of the distribution is <span class="math inline">0.886\theta^{-\frac{1}{2}}</span>. Suppose we observe data <span class="math inline">x_1,\dots,x_n</span> as independent samples from the Weibull(2) distribution.</p>
<section id="question-1.1-8-points" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="question-1.1-8-points"><span class="header-section-number">1.1</span> Question 1.1 (8 points)</h2>
<p>Show that the Gamma distribution, i.e.&nbsp;Ga(<span class="math inline">a, b</span>), is the conjugate prior distribution and derive the posterior distribution. Use the p.d.f. <span class="math inline">\pi(\theta) = \frac{b^a}{\Gamma(a)}\theta^{a-1}\text{exp}(-b\theta)</span>.</p>
<span class="math display">\begin{align*}
f(x_1,\dots,x_n|\theta) &amp;= \prod_{i = 1}^{n}2\theta x_i \text{exp}(-\theta x_i^2) = 2^n \theta^n \bigg(\prod_{i = 1}^{n}x_i\bigg) \text{exp}\bigg(-\theta \sum_{i= 1}^nx_i^2\bigg) \propto \theta^n \text{exp}\bigg(-\theta \sum_{i= 1}^nx_i^2\bigg)\\
\pi(\theta) &amp;= \frac{b^a}{\Gamma(a)}\theta^{a-1} \text{exp}(-b\theta) \propto \theta^{a-1} \text{exp}(-b\theta)\\
\pi(\theta | x_1, \dots, x_n) &amp;\propto f(x_1,\dots,x_n|\theta)\pi(\theta) \propto \theta^n \text{exp}\bigg(-\theta \sum_{i= 1}^nx_i^2\bigg)\theta^{a-1} \text{exp}(-b\theta)  = \theta^{a+n - 1} \text{exp}\bigg(-\theta \bigg( b + \sum_{i= 1}^nx_i^2\bigg)\bigg)\\
\\
\theta &amp;\sim Ga(a,b)\\
x_1,\dots,x_n|\theta &amp;\sim \text{Weibull}(2)\\
\theta|x_1,\dots,x_n &amp;\sim Ga(a + n,  b + \sum_{i= 1}^n x_i^2) \\
\end{align*}</span>
<div style="page-break-after: always;"></div>
</section>
<section id="question-1.2-8-points" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="question-1.2-8-points"><span class="header-section-number">1.2</span> Question 1.2 (8 points)</h2>
<p>Derive the marginal distribution <span class="math inline">\pi(x_1,\dots,x_n)</span>. (Hint: There are two related ways to obtain the marginal, through <span class="math inline">\pi(x_1,\dots,x_n) = \int f(x_1,\dots,x_n|\theta)\pi(\theta) d\theta</span> or <span class="math inline">\pi(x_1,\dots,x_n) = \frac{f(x_1,\dots,x_n|\theta)}{\pi(\theta|x_1,\dots,x_n)}</span></p>
<span class="math display">\begin{align*}
\pi(x_1,\dots,x_n) &amp;= \int f(x_1,\dots,x_n|\theta)\pi(\theta) d\theta \\
&amp;= \int_0^\infty 2^n \theta^n \bigg(\prod_{i = 1}^{n}x_i\bigg) \text{exp}\bigg(-\theta \sum_{i= 1}^nx_i^2\bigg) \frac{b^a}{\Gamma(a)}\theta^{a-1} \text{exp}(-b\theta) d\theta \\
&amp;= \frac{2^n b^a \bigg(\prod_{i = 1}^{n}x_i\bigg)}{\Gamma(a)} \int_0^\infty \theta^{a+n - 1} \text{exp}\bigg(-\theta \bigg( b + \sum_{i= 1}^nx_i^2\bigg)\bigg) d\theta\\
&amp;= \frac{2^n b^a \bigg(\prod_{i = 1}^{n}x_i\bigg)}{\Gamma(a)} \frac{\Gamma(a+n)}{\bigg( b + \sum_{i= 1}^nx_i^2\bigg)^{a+n}}\\
\end{align*}</span>
<p>For this problem I could not think of a known distribution for the marginal distribution of the sample.</p>
</section>
<section id="question-1.3-4-points" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="question-1.3-4-points"><span class="header-section-number">1.3</span> Question 1.3 (4 points)</h2>
<p>In one application, the lifetime of a kind of gear was measured in <span class="math inline">1,000</span> hours. Let <span class="math inline">x = 1</span> means the part lasted <span class="math inline">1,000</span> hours and <span class="math inline">x = 1/2</span> means the part lasted <span class="math inline">500</span> hours. Gears tend to last between <span class="math inline">500</span> and <span class="math inline">5,000</span> hours, with <span class="math inline">1,000</span> being a typical lifetime. This suggests a Gamma prior distribution for <span class="math inline">\theta</span> with <span class="math inline">a = 1.4</span> and <span class="math inline">b = 2</span>. Obtain a graph of this prior density and argue that this choice of prior is reasonable given the information provided.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sim setting</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7330</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get density for the domain 0 to 5</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>prior.theta <span class="ot">&lt;-</span> <span class="fu">dgamma</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="at">length.out =</span> T),<span class="at">shape =</span> <span class="fl">1.4</span>,<span class="at">rate =</span> <span class="dv">2</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot prior</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="at">length.out =</span> T),<span class="at">prior.theta =</span> prior.theta)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df,<span class="fu">aes</span>(<span class="at">x =</span> x,<span class="at">y =</span> prior.theta)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"theta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q1.3-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption><span class="math inline">\pi(\theta)</span></figcaption>
</figure>
</div>
</div>
</div>
<p>The mean of the prior is 0.7, and if we plug this value into the mean of the weibull(2) <span class="math inline">0.886(.7)^{-\frac{1}{2}} = 1.058973</span> which is in the expected interval. From this it seems that the gamma prior <span class="math inline">a = 1.4</span> and <span class="math inline">b = 2</span> works well into the expected behavior.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="question-1.4-8-points" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="question-1.4-8-points"><span class="header-section-number">1.4</span> Question 1.4 (8 points)</h2>
<p>Suppose that we observed <span class="math inline">n = 10</span> with</p>
<span class="math display">\begin{align*}
x &amp;= (0.25, 0.52, 0.60, 0.91, 0.97, 1.00, 1.07, 1.09, 1.18, 1.38).\\
\end{align*}</span>
<p>Evidently this gear is fairly typical with lifetimes around <span class="math inline">1,000</span>. Find and graph the posterior distribution. Give the posterior mean and variance. Give a <span class="math inline">95\%</span> posterior interval for <span class="math inline">\theta</span>, using both analytical and numerical approaches.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7330</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data stats </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.52</span>, <span class="fl">0.60</span>, <span class="fl">0.91</span>, <span class="fl">0.97</span>, <span class="fl">1.00</span>, <span class="fl">1.07</span>, <span class="fl">1.09</span>, <span class="fl">1.18</span>, <span class="fl">1.38</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>x2. <span class="ot">&lt;-</span> <span class="fu">sum</span>(x2)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># prior settings</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">1.4</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># number of samples</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate posterior</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>post.theta <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(T,<span class="at">shape =</span> (a<span class="sc">+</span>n),<span class="at">rate =</span> (b <span class="sc">+</span> x2.)) </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>post.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(post.theta)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>post.var <span class="ot">&lt;-</span> <span class="fu">var</span>(post.theta)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(post.theta,<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(post.theta,<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># graphing posterior with mean and ci</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>df.post.theta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">theta =</span> post.theta,<span class="at">group =</span> <span class="fu">rep</span>(<span class="st">"post.theta"</span>,T))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.post.theta, <span class="fu">aes</span>(<span class="at">x =</span> theta,<span class="at">fill =</span> group,<span class="at">color =</span> group)) <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(lower.cl,upper.cl),<span class="at">color =</span> <span class="st">"limegreen"</span>)<span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> post.mean, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q1.4.1-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption><span class="math inline">\pi(\theta|x_1,\dots,x_n)</span></figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating table for numerical and analytical results of the posterior dist</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> numerical <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.var,<span class="dv">5</span>),<span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(upper.cl,<span class="dv">5</span>),<span class="st">")"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> analytical <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>((a<span class="sc">+</span>n)<span class="sc">/</span>(b <span class="sc">+</span> x2.),<span class="dv">5</span>),<span class="fu">round</span>((a<span class="sc">+</span>n)<span class="sc">/</span>(b <span class="sc">+</span> x2.)<span class="sc">^</span><span class="dv">2</span>,<span class="dv">5</span>),<span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(<span class="fu">qgamma</span>(<span class="fl">0.025</span>,<span class="at">shape =</span> (a<span class="sc">+</span>n),<span class="at">rate =</span> (b <span class="sc">+</span> x2.)),<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(<span class="fu">qgamma</span>(<span class="fl">0.975</span>,<span class="at">shape =</span> (a<span class="sc">+</span>n),<span class="at">rate =</span> (b <span class="sc">+</span> x2.)),<span class="dv">5</span>),<span class="st">")"</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> table.q1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(numerical,analytical))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">row.names</span>(table.q1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Numerical"</span>,<span class="st">"Analytical"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(kableExtra)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a> knitr<span class="sc">::</span><span class="fu">kable</span>(table.q1,<span class="at">booktabs =</span> T,<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Posterior Mean"</span>,<span class="st">"Posterior Variance"</span>, <span class="st">"95% Credible interval"</span>),<span class="at">caption =</span> <span class="st">"Numerical vs Analytical approaches"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Numerical vs Analytical approaches</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Posterior Mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Posterior Variance</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">95% Credible interval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Numerical</td>
<td style="text-align: left;">1.03152</td>
<td style="text-align: left;">0.09537</td>
<td style="text-align: left;">( 0.52734 , 1.72616 )</td>
</tr>
<tr class="even">
<td style="text-align: left;">Analytical</td>
<td style="text-align: left;">1.0278</td>
<td style="text-align: left;">0.09266</td>
<td style="text-align: left;">( 0.52051 , 1.70475 )</td>
</tr>
</tbody>
</table>


</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="problem-2-change-point-model" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Problem 2: Change-point model</h1>
<p>Consider the following hierarchical change-point model for the number of occurrence <span class="math inline">Y_i</span> of some event during time interval <span class="math inline">i</span>:</p>
<span class="math display">\begin{align*}
Y_i &amp;\sim \begin{cases} \text{Poi}(\theta) \quad i = 1,\dots, k \\ \text{Poi}(\lambda) \quad i = k+1,\dots, n  \end{cases},\\
\end{align*}</span>
<p>with the following prior formulation: <span class="math inline">\theta \sim Ga(a_1,\beta_1)</span> and <span class="math inline">\lambda \sim Ga(a_2,\beta_2)</span> with <span class="math inline">\theta</span> and <span class="math inline">\lambda</span> independent. We further assume <span class="math inline">\beta_1 \sim IG(c_1,d_1)</span> and <span class="math inline">\beta_2 \sim IG(c_2,d_2)</span>. The p.d.f.’s of those priors are defined as below:</p>
<span class="math display">\begin{align*}
\pi(\theta|a_1,\beta_1) &amp;= \frac{1}{\beta_1^{a_1}\Gamma(a_1)}\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \\
\pi(\lambda|a_2,\beta_2) &amp;= \frac{1}{\beta_2^{a_2}\Gamma(a_2)}\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg) \\
\pi(\beta_1|c_1,d_1) &amp;= \frac{1}{d_1^{c_1}\Gamma(c_1)}\bigg(\frac{1}{\beta_1}\bigg)^{c_1 + 1}\text{exp}\bigg(-\frac{1}{d_1 \beta_1}\bigg) \\
\pi(\beta_2|c_2,d_2) &amp;= \frac{1}{d_2^{c_2}\Gamma(c_2)}\bigg(\frac{1}{\beta_2}\bigg)^{c_2 + 1}\text{exp}\bigg(-\frac{1}{d_2 \beta_2}\bigg) \\
\end{align*}</span>
<section id="question-2.1-10-points" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="question-2.1-10-points"><span class="header-section-number">2.1</span> Question 2.1 (10 points)</h2>
<p>Fit this model the “coal-data.txt”, which gives counts of coal mining disasters in Great Britain by year from 1851 to 1962, where disaster is defined as an accident resulting in the deaths of 10 or more minors. Set the hyperparameters to be reasonably non-informative to: <span class="math inline">a_1 = a_2 = 0.5</span>, <span class="math inline">c_1 = c_2 = 1</span>, and <span class="math inline">d_1 = d_2 = 1</span>. Assume <span class="math inline">k = 40</span> (corresponding to year 1890). Derive full conditional distributions for <span class="math inline">\theta</span> and <span class="math inline">\lambda</span>.</p>
<span class="math display">\begin{align*}
\pi(\theta|a_1,\beta_1) &amp;= \frac{1}{\beta_1^{a_1}\Gamma(a_1)}\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \\
\pi(\lambda|a_2,\beta_2) &amp;= \frac{1}{\beta_2^{a_2}\Gamma(a_2)}\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg) \\
\pi(\beta_1|c_1,d_1) &amp;= \frac{1}{d_1^{c_1}\Gamma(c_1)}\bigg(\frac{1}{\beta_1}\bigg)^{c_1 + 1}\text{exp}\bigg(-\frac{1}{d_1 \beta_1}\bigg) \\
\pi(\beta_2|c_2,d_2) &amp;= \frac{1}{d_2^{c_2}\Gamma(c_2)}\bigg(\frac{1}{\beta_2}\bigg)^{c_2 + 1}\text{exp}\bigg(-\frac{1}{d_2 \beta_2}\bigg) \\
f(y_1,\dots,y_n|\theta,\lambda) &amp;= \prod_{i = 1}^k \frac{\theta^{y_i}\text{exp}(-\theta)}{y_i!}\prod_{i = k+1}^n \frac{\lambda^{y_i}\text{exp}(-\lambda)}{y_i!}\\
\pi(\theta|a_1,\beta_1,y_1, \dots,y_k) &amp;\propto f(y_1,\dots,y_k|\theta)\pi(\theta|a_1,\beta_1)\\
&amp;= \prod_{i = 1}^k \frac{\theta^{y_i}\text{exp}(-\theta)}{y_i!}\frac{1}{\beta_1^{a_1}\Gamma(a_1)}\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \\
&amp;\propto \theta^{\sum_{i = 1}^k y_i}\text{exp}(-k\theta)\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \\
&amp;= \theta^{a_1 + \sum_{i = 1}^k y_i - 1}\text{exp}\bigg(-\theta\bigg(\frac{k\beta_1 + 1}{\beta_1}\bigg)\bigg) \\
\theta|a_1,\beta_1,y_1, \dots,y_k &amp;\sim Ga\bigg(a_1 + \sum_{i = 1}^k y_i, \frac{k\beta_1 + 1}{\beta_1}\bigg) \\
\pi(\lambda|a_2,\beta_2,y_{k+1}, \dots,y_n) &amp;\propto f(y_{k+1},\dots,y_n|\lambda)\pi(\lambda|a_2,\beta_2)\\
&amp;= \prod_{i = k+1}^n \frac{\lambda^{y_i}\text{exp}(-\lambda)}{y_i!}  \frac{1}{\beta_2^{a_2}\Gamma(a_2)}\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg) \\
&amp; \propto \lambda^{\sum_{i = k+1}^{n} y_i}\text{exp}(-(n-k)\lambda)\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg)\\
&amp;= \lambda^{a_2 + \sum_{i = k+1}^{n} y_i - 1}\text{exp}\bigg(-\lambda\bigg(\frac{(n-k)\beta_2 + 1}{\beta_2}\bigg)\bigg)\\
\lambda | a_2,\beta_2,y_{k+1}, \dots,y_n &amp;\sim Ga\bigg(a_2 + \sum_{i = k+1}^{n} y_i, \frac{(n-k)\beta_2 + 1}{\beta_2}\bigg)\\
\pi(\beta_1|\theta,a_1,c_1,d_1) &amp;\propto \pi(\theta|a_1,\beta_1)\pi(\beta_1|c_1,d_1)\\
&amp;= \frac{1}{\beta_1^{a_1}\Gamma(a_1)}\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg)\frac{1}{d_1^{c_1}\Gamma(c_1)}\bigg(\frac{1}{\beta_1}\bigg)^{c_1 + 1}\text{exp}\bigg(-\frac{1}{d_1 \beta_1}\bigg)\\
&amp;\propto \bigg(\frac{1}{\beta_1}\bigg)^{a_1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg)\bigg(\frac{1}{\beta_1}\bigg)^{c_1 + 1}\text{exp}\bigg(-\frac{1}{d_1 \beta_1}\bigg)\\
&amp;= \bigg(\frac{1}{\beta_1}\bigg)^{a_1 + c_1 + 1}\text{exp}\bigg(-\frac{1}{\beta_1}\bigg(\frac{d_1\theta + 1}{d_1}\bigg)\bigg) \\
\beta_1|\theta,a_1,c_1,d_1 &amp;\sim IG\bigg(a_1 + c_1, \bigg(\frac{d_1\theta + 1}{d_1}\bigg)\bigg)\\
\pi(\beta_2|\lambda,a_2,c_2,d_2) &amp;\propto \pi(\lambda|a_2,\beta_2)\pi(\beta_2|c_2,d_2)\\
&amp; = \frac{1}{\beta_2^{a_2}\Gamma(a_2)}\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg)\frac{1}{d_2^{c_2}\Gamma(c_2)}\bigg(\frac{1}{\beta_2}\bigg)^{c_2 + 1}\text{exp}\bigg(-\frac{1}{d_2 \beta_2}\bigg) \\
&amp;\propto \bigg(\frac{1}{\beta_2}\bigg)^{a_2}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg)\bigg(\frac{1}{\beta_2}\bigg)^{c_2 + 1}\text{exp}\bigg(-\frac{1}{d_2 \beta_2}\bigg)\\
&amp;= \bigg(\frac{1}{\beta_2}\bigg)^{a_2 + c_2 + 1}\text{exp}\bigg(-\frac{1}{\beta_2}\bigg(\frac{d_2\lambda+1}{d_2}\bigg)\bigg)\\
\beta_2|\lambda,a_2,c_2,d_2 &amp;\sim IG\bigg(a_2 + c_2,\bigg(\frac{d_2\lambda+1}{d_2}\bigg)\bigg)
\end{align*}</span>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>coal.miners <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"coal_data.txt"</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"disasters"</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#head(coal.miners)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(coal.miners,<span class="at">group =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"time 1"</span>,<span class="dv">40</span>),<span class="fu">rep</span>(<span class="st">"time 2"</span>,<span class="fu">length</span>(<span class="dv">41</span><span class="sc">:</span><span class="fu">dim</span>(coal.miners)[<span class="dv">1</span>]))))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> year,<span class="at">y =</span> disasters,<span class="at">color =</span> group)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="co">#+ geom_histogram()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2%20data%20plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="question-2.2-10-points" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="question-2.2-10-points"><span class="header-section-number">2.2</span> Question 2.2 (10 points)</h2>
<p>Implement a Gibbs sampler to derive the posterior distributions of <span class="math inline">\theta</span>, <span class="math inline">\lambda</span>, and <span class="math inline">R = \theta/\lambda</span>. Provide the histograms and kernel density estimates along with the posterior sample summaries: means, standard deviations, quantiles etc. What is meant by “convergence diagnosis”? Describe some tools you might use to assist in this regard. Present some evidence that the MCMC has reasonably converged.</p>
<p>Convergence diagnostics are steps taken in analyzing the posterior samples and determining if the sequence is stable/stationary/converged to the “true value”. Some options to determine whether sample estimates have not converged are:<br>
look at a trace plot individually and jointly,<br>
create multiple chains with different initial values and observe if all the chains converge to same value,<br>
look at the autocorrelation if low autocorrelation then speed of mixing is fast and see if auto correlation drops over time if not this is an indicator that converge may be an issue or will be slow,<br>
you can also use different statistical test such as Geweke statistic, Gelman-Rubin Statistic.</p>
<p>Below we can see that comparing the trace plots of four chains with different starting values that they all converge to around the same value, so this indicates that there is no obvious convergence issues. The joint trace plot of <span class="math inline">\theta</span> and <span class="math inline">\lambda</span> also does not indicate that there are any convergence issues. The acf of each of the sequences drops really fast, so this indicates that there are no obvious mixing issues and fast movement in the parameter space. From each of these findings there seems to be no indication of convergence issues.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>gibbs.k <span class="ot">&lt;-</span> <span class="cf">function</span>(y,<span class="at">a1 =</span> <span class="fl">0.5</span>, <span class="at">a2 =</span> <span class="fl">0.5</span>, <span class="at">c1 =</span> <span class="dv">1</span>,<span class="at">c2 =</span> <span class="dv">1</span>,<span class="at">d1 =</span> <span class="dv">1</span>,<span class="at">d2 =</span> <span class="dv">1</span>,<span class="at">k =</span> <span class="dv">40</span>,<span class="at">T =</span> <span class="dv">10000</span>, <span class="at">B =</span> T<span class="sc">/</span><span class="dv">2</span>,theta_initial,lambda_initial,R_initial,beta1_initial,beta2_initial,<span class="at">seed =</span> <span class="dv">7330</span>) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sim settings</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data settings</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> k</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> n<span class="sc">-</span>k</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  y1. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  y2. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n])</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  theta <span class="ot">&lt;-</span> theta_initial</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> lambda_initial</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> R_initial</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  beta1 <span class="ot">&lt;-</span> beta1_initial</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  beta2 <span class="ot">&lt;-</span> beta2_initial</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initializing storage</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  theta_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  lambda_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  R_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  beta1_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  beta2_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gibbs sampler </span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(B<span class="sc">+</span>T)){</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># draw theta</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    theta_shape <span class="ot">&lt;-</span> a1 <span class="sc">+</span> y1.</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    theta_rate <span class="ot">&lt;-</span> (k<span class="sc">*</span>beta1 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta1</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    theta <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> theta_shape,<span class="at">rate =</span> theta_rate)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># draw lambda</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    lambda_shape <span class="ot">&lt;-</span> a2 <span class="sc">+</span> y2.</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    lambda_rate <span class="ot">&lt;-</span> (n2<span class="sc">*</span>beta2 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta2</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> lambda_shape,<span class="at">rate =</span> lambda_rate)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># draw beta1</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    beta1_shape <span class="ot">&lt;-</span> a1 <span class="sc">+</span> c1</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    beta1_rate <span class="ot">&lt;-</span> (d1<span class="sc">*</span>theta <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>d1</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    beta1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> beta1_shape,<span class="at">rate =</span> beta1_rate)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># draw beta2</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    beta2_shape <span class="ot">&lt;-</span> a2 <span class="sc">+</span> c2</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    beta2_rate <span class="ot">&lt;-</span> (d2<span class="sc">*</span>lambda <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>d2</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    beta2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> beta2_shape,<span class="at">rate =</span> beta2_rate)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store results</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    theta_store[t] <span class="ot">&lt;-</span> theta</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    lambda_store[t] <span class="ot">&lt;-</span> lambda</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    R_store[t] <span class="ot">&lt;-</span> theta<span class="sc">/</span>lambda</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    beta1_store[t] <span class="ot">&lt;-</span> beta1</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    beta2_store[t] <span class="ot">&lt;-</span> beta2</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">theta_store =</span> theta_store,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>              <span class="at">lambda_store =</span> lambda_store,</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>              <span class="at">R_store =</span> R_store,</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>              <span class="at">beta1_store =</span> beta1_store,</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">beta2_store =</span> beta2_store))</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> T<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>chain1 <span class="ot">&lt;-</span> <span class="fu">gibbs.k</span>(<span class="at">y =</span> coal.miners<span class="sc">$</span>disasters,<span class="at">theta_initial =</span> <span class="dv">5</span>,<span class="at">lambda_initial =</span> <span class="dv">1</span>,<span class="at">R_initial =</span> <span class="dv">5</span>,<span class="at">beta1_initial  =</span> <span class="dv">3</span>,<span class="at">beta2_initial =</span> <span class="dv">4</span>)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>chain2 <span class="ot">&lt;-</span> <span class="fu">gibbs.k</span>(<span class="at">y =</span> coal.miners<span class="sc">$</span>disasters,<span class="at">theta_initial =</span> <span class="dv">0</span>,<span class="at">lambda_initial =</span> <span class="dv">10</span>,<span class="at">R_initial =</span> <span class="dv">0</span>,<span class="at">beta1_initial  =</span> <span class="dv">3</span>,<span class="at">beta2_initial =</span> <span class="dv">4</span>)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>chain3 <span class="ot">&lt;-</span> <span class="fu">gibbs.k</span>(<span class="at">y =</span> coal.miners<span class="sc">$</span>disasters,<span class="at">theta_initial =</span> <span class="dv">20</span>,<span class="at">lambda_initial =</span> <span class="dv">5</span>,<span class="at">R_initial =</span> <span class="dv">4</span>,<span class="at">beta1_initial  =</span> <span class="dv">3</span>,<span class="at">beta2_initial =</span> <span class="dv">4</span>)</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>chain4 <span class="ot">&lt;-</span> <span class="fu">gibbs.k</span>(<span class="at">y =</span> coal.miners<span class="sc">$</span>disasters,<span class="at">theta_initial =</span> <span class="dv">10</span>,<span class="at">lambda_initial =</span> <span class="dv">50</span>,<span class="at">R_initial =</span> <span class="fl">0.2</span>,<span class="at">beta1_initial  =</span> <span class="dv">3</span>,<span class="at">beta2_initial =</span> <span class="dv">4</span>)</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>df.theta.chain <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">theta =</span> <span class="fu">c</span>(<span class="fu">c</span>(<span class="dv">5</span>,chain1<span class="sc">$</span>theta_store), <span class="fu">c</span>(<span class="dv">0</span>,chain2<span class="sc">$</span>theta_store), <span class="fu">c</span>(<span class="dv">20</span>,chain3<span class="sc">$</span>theta_store), <span class="fu">c</span>(<span class="dv">10</span>,chain4<span class="sc">$</span>theta_store)),</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Iteration =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B)),</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chain =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"C1"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C2"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C3"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C4"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>df.lambda.chain <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lambda =</span> <span class="fu">c</span>(<span class="fu">c</span>(<span class="dv">1</span>,chain1<span class="sc">$</span>lambda_store), <span class="fu">c</span>(<span class="dv">10</span>,chain2<span class="sc">$</span>lambda_store), <span class="fu">c</span>(<span class="dv">5</span>,chain3<span class="sc">$</span>lambda_store), <span class="fu">c</span>(<span class="dv">50</span>,chain4<span class="sc">$</span>lambda_store)),</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Iteration =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B)),</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chain =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"C1"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C2"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C3"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C4"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>df.R.chain <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">R =</span> <span class="fu">c</span>(<span class="fu">c</span>(<span class="dv">5</span>,chain1<span class="sc">$</span>R_store), <span class="fu">c</span>(<span class="dv">0</span>,chain2<span class="sc">$</span>R_store), <span class="fu">c</span>(<span class="dv">4</span>,chain3<span class="sc">$</span>R_store), <span class="fu">c</span>(<span class="fl">0.2</span>,chain4<span class="sc">$</span>R_store)),</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Iteration =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B),<span class="dv">0</span><span class="sc">:</span>(T<span class="sc">+</span>B)),</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chain =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"C1"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C2"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C3"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"C4"</span>,B<span class="sc">+</span>T<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="fu">ggplot</span>(df.theta.chain,<span class="fu">aes</span>(<span class="at">x =</span> Iteration,<span class="at">y =</span> theta,<span class="at">color =</span> chain)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>)) ,</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>             <span class="fu">ggplot</span>(df.lambda.chain,<span class="fu">aes</span>(<span class="at">x =</span> Iteration,<span class="at">y =</span> lambda,<span class="at">color =</span> chain)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>)) ,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>             <span class="fu">ggplot</span>(df.R.chain,<span class="fu">aes</span>(<span class="at">x =</span> Iteration,<span class="at">y =</span> R,<span class="at">color =</span> chain)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>), <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>)) ,</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.2%20chain%20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sim settings</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7330</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> T<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># prior settings</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># data settings</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> coal.miners<span class="sc">$</span>disasters</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> k</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> n<span class="sc">-</span>k</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>y1. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>y2. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n])</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># setting initial values</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>theta_initial <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>lambda_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>R_initial <span class="ot">&lt;-</span> theta_initial<span class="sc">/</span>lambda_initial</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>beta1_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>beta2_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_initial</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> lambda_initial</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> R_initial</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> beta1_initial</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">&lt;-</span> beta2_initial</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># initializing storage</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>theta_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>lambda_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>R_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>beta1_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>beta2_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co"># gibbs sampler </span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(B<span class="sc">+</span>T)){</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw theta</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  theta_shape <span class="ot">&lt;-</span> a1 <span class="sc">+</span> y1.</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  theta_rate <span class="ot">&lt;-</span> (k<span class="sc">*</span>beta1 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta1</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  theta <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> theta_shape,<span class="at">rate =</span> theta_rate)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw lambda</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  lambda_shape <span class="ot">&lt;-</span> a2 <span class="sc">+</span> y2.</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  lambda_rate <span class="ot">&lt;-</span> (n2<span class="sc">*</span>beta2 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta2</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> lambda_shape,<span class="at">rate =</span> lambda_rate)</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw beta1</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  beta1_shape <span class="ot">&lt;-</span> a1 <span class="sc">+</span> c1</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  beta1_rate <span class="ot">&lt;-</span> (d1<span class="sc">*</span>theta <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>d1</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  beta1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> beta1_shape,<span class="at">rate =</span> beta1_rate)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw beta2</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  beta2_shape <span class="ot">&lt;-</span> a2 <span class="sc">+</span> c2</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  beta2_rate <span class="ot">&lt;-</span> (d2<span class="sc">*</span>lambda <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>d2</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  beta2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> beta2_shape,<span class="at">rate =</span> beta2_rate)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store results</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  theta_store[t] <span class="ot">&lt;-</span> theta</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>  lambda_store[t] <span class="ot">&lt;-</span> lambda</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  R_store[t] <span class="ot">&lt;-</span> theta<span class="sc">/</span>lambda</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  beta1_store[t] <span class="ot">&lt;-</span> beta1</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  beta2_store[t] <span class="ot">&lt;-</span> beta2</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics theta</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>post.theta.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>post.theta.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>post.theta.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>post.theta.min <span class="ot">&lt;-</span> <span class="fu">min</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>post.theta.max <span class="ot">&lt;-</span> <span class="fu">max</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>post.theta.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>post.theta.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics lambda</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>post.lambda.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>post.lambda.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>post.lambda.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>post.lambda.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>post.lambda.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>post.lambda.min <span class="ot">&lt;-</span> <span class="fu">min</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>post.lambda.max <span class="ot">&lt;-</span> <span class="fu">max</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics R</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>post.R.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>post.R.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>post.R.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>post.R.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>post.R.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>post.R.min <span class="ot">&lt;-</span> <span class="fu">min</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>post.R.max <span class="ot">&lt;-</span> <span class="fu">max</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics beta1</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>post.beta1.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>post.beta1.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>post.beta1.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>post.beta1.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>post.beta1.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>post.beta1.min <span class="ot">&lt;-</span> <span class="fu">min</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>post.beta1.max <span class="ot">&lt;-</span> <span class="fu">max</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics beta2</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>post.beta2.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>post.beta2.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>post.beta2.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>post.beta2.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>post.beta2.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>post.beta2.min <span class="ot">&lt;-</span> <span class="fu">min</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>post.beta2.max <span class="ot">&lt;-</span> <span class="fu">max</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor convergence</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">cbind</span> (<span class="fu">c</span>( theta_initial , theta_store ) , <span class="fu">c</span>( lambda_initial , lambda_store ) ) , <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>) , <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="fu">expression</span> ( theta ) , <span class="at">ylab =</span> <span class="fu">expression</span> ( lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( theta_initial , theta_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span> ( theta ), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( lambda_initial , lambda_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( R_initial , R_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( <span class="at">R =</span> theta<span class="sc">/</span>lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( beta1_initial , beta1_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( beta1 ) , <span class="at">las =</span> <span class="dv">1</span>,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1500</span>))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( beta2_initial , beta2_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( beta2 ) , <span class="at">las =</span> <span class="dv">1</span>,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.2%20trace-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the joint and marginal posterior</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(MASS)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># contour</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">kde2d</span> ( theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)] , lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(z , <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">3.75</span>) , <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>) , <span class="at">las =</span> <span class="dv">1</span>, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">expression</span> ( theta ) , <span class="at">ylab =</span><span class="fu">expression</span> ( lambda ) )</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># theta hist</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span> , <span class="at">xlab =</span> <span class="fu">expression</span>( theta ), <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.theta.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.theta.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.theta.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.theta.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.theta.lower.cl,post.theta.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda hist</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="fu">expression</span>( lambda ), <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.lambda.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.lambda.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.lambda.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.lambda.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.lambda.lower.cl,post.lambda.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># R hist</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="fu">expression</span>( <span class="at">R =</span> theta<span class="sc">/</span> lambda ), <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.R.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.R.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.R.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.R.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.R.lower.cl,post.R.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co"># beta1 hist</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"beta1"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.beta1.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.beta1.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.beta1.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.beta1.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.beta1.lower.cl,post.beta1.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co"># beta2 hist</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"beta2"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.beta2.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.beta2.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.beta2.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.beta2.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.beta2.lower.cl,post.beta2.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.2%20hist-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># acf plots</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.2%20acf-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary table </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>post.theta.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.theta.min,<span class="dv">5</span>),<span class="fu">round</span>(post.theta.meadian,<span class="dv">5</span>),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.theta.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.theta.sd,<span class="dv">5</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.theta.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">round</span>(post.theta.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>), </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.theta.max,<span class="dv">5</span>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>post.lambda.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.lambda.min,<span class="dv">5</span>),<span class="fu">round</span>(post.lambda.meadian,<span class="dv">5</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">round</span>(post.lambda.mean,<span class="dv">5</span>), <span class="fu">round</span>(post.lambda.sd,<span class="dv">5</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.lambda.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">round</span>(post.lambda.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">round</span>(post.lambda.max,<span class="dv">5</span>))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>post.R.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.R.min,<span class="dv">5</span>),<span class="fu">round</span>(post.R.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.R.mean,<span class="dv">5</span>), <span class="fu">round</span>(post.R.sd,<span class="dv">5</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.R.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.R.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.R.max,<span class="dv">5</span>))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>post.beta1.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.beta1.min,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.sd,<span class="dv">5</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.beta1.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.beta1.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.beta1.max,<span class="dv">5</span>))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>post.beta2.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.beta2.min,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.sd,<span class="dv">5</span>),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.beta2.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.beta2.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.beta2.max,<span class="dv">5</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>table.q22 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(post.theta.summary,post.lambda.summary,post.R.summary,post.beta1.summary,post.beta2.summary))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table.q22) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"theta"</span>,<span class="st">"lambda"</span>,<span class="st">"R"</span>,<span class="st">"beta1"</span>,<span class="st">"beta2"</span>)<span class="co">#paste("$",c("\\theta","\\lambda","R"),"$",sep = "")</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#c("$\\theta$","$\\lambda$","$R = \\theta/\\lambda$")</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table.q22,<span class="at">booktabs =</span> T,<span class="at">format =</span> <span class="st">"pandoc"</span>,<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Posterior Min"</span>,<span class="st">"Posterior Median"</span>,<span class="st">"Posterior Mean"</span>,<span class="st">"Posterior sd"</span>, <span class="st">"95% Credible interval"</span>,<span class="st">"Posterior Max"</span>),<span class="at">caption =</span> <span class="st">"Posterior Summary Statistics of $</span><span class="sc">\\</span><span class="st">theta,</span><span class="sc">\\</span><span class="st">lambda,R = </span><span class="sc">\\</span><span class="st">theta / </span><span class="sc">\\</span><span class="st">lambda$, $</span><span class="sc">\\</span><span class="st">beta_1$, $</span><span class="sc">\\</span><span class="st">beta_2$"</span>, <span class="at">align =</span> <span class="st">"cccccc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>,<span class="st">"scale_down"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Posterior Summary Statistics of <span class="math inline">\theta,\lambda,R = \theta / \lambda</span>, <span class="math inline">\beta_1</span>, <span class="math inline">\beta_2</span></caption>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Posterior Min</th>
<th style="text-align: center;">Posterior Median</th>
<th style="text-align: center;">Posterior Mean</th>
<th style="text-align: center;">Posterior sd</th>
<th style="text-align: center;">95% Credible interval</th>
<th style="text-align: center;">Posterior Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>theta</td>
<td style="text-align: center;">2.05241</td>
<td style="text-align: center;">3.10642</td>
<td style="text-align: center;">3.11134</td>
<td style="text-align: center;">0.2781</td>
<td style="text-align: center;">( 2.59497 , 3.68466 )</td>
<td style="text-align: center;">4.356</td>
</tr>
<tr class="even">
<td>lambda</td>
<td style="text-align: center;">0.53804</td>
<td style="text-align: center;">0.91064</td>
<td style="text-align: center;">0.91461</td>
<td style="text-align: center;">0.11181</td>
<td style="text-align: center;">( 0.708 , 1.14707 )</td>
<td style="text-align: center;">1.45332</td>
</tr>
<tr class="odd">
<td>R</td>
<td style="text-align: center;">1.87774</td>
<td style="text-align: center;">3.41033</td>
<td style="text-align: center;">3.45308</td>
<td style="text-align: center;">0.52658</td>
<td style="text-align: center;">( 2.54503 , 4.61844 )</td>
<td style="text-align: center;">5.85961</td>
</tr>
<tr class="even">
<td>beta1</td>
<td style="text-align: center;">0.36172</td>
<td style="text-align: center;">3.46552</td>
<td style="text-align: center;">8.81313</td>
<td style="text-align: center;">51.10141</td>
<td style="text-align: center;">( 0.87443 , 41.89753 )</td>
<td style="text-align: center;">3945.77613</td>
</tr>
<tr class="odd">
<td>beta2</td>
<td style="text-align: center;">0.16001</td>
<td style="text-align: center;">1.63836</td>
<td style="text-align: center;">5.25214</td>
<td style="text-align: center;">129.67036</td>
<td style="text-align: center;">( 0.40776 , 18.85458 )</td>
<td style="text-align: center;">12642.94199</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="question-2.3-10-points" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="question-2.3-10-points"><span class="header-section-number">2.3</span> Question 2.3 (10 points)</h2>
<p>Now assume that k is unknown and adopt the following prior:</p>
<span class="math display">\begin{align*}
k &amp;\sim \text{Discrete-Unif}(1,n),\\
\end{align*}</span>
<p>which should be independent of <span class="math inline">\theta</span> and <span class="math inline">\lambda</span>. Now add <span class="math inline">k</span> into the sampling chain, and obtain the marginal posterior density estimate for it. What is the effect on the posterior for <span class="math inline">R = \theta/\lambda</span>?</p>
<span class="math display">\begin{align*}
\pi(\theta|a_1,\beta_1) &amp;= \frac{1}{\beta_1^{a_1}\Gamma(a_1)}\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \\
\pi(\lambda|a_2,\beta_2) &amp;= \frac{1}{\beta_2^{a_2}\Gamma(a_2)}\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg) \\
\pi(\beta_1|c_1,d_1) &amp;= \frac{1}{d_1^{c_1}\Gamma(c_1)}\bigg(\frac{1}{\beta_1}\bigg)^{c_1 + 1}\text{exp}\bigg(-\frac{1}{d_1 \beta_1}\bigg) \\
\pi(\beta_2|c_2,d_2) &amp;= \frac{1}{d_2^{c_2}\Gamma(c_2)}\bigg(\frac{1}{\beta_2}\bigg)^{c_2 + 1}\text{exp}\bigg(-\frac{1}{d_2 \beta_2}\bigg) \\
\pi(k|n) &amp;= \frac{1}{n} \\
f(y_1,\dots,y_n|\theta,\lambda,k) &amp;= \prod_{i = 1}^k \frac{\theta^{y_i}\text{exp}(-\theta)}{y_i!}\prod_{i = k+1}^n \frac{\lambda^{y_i}\text{exp}(-\lambda)}{y_i!} = \frac{1}{\prod_{i = 1}^n y_i!}\theta^{\sum_{i = 1}^k y_i}\text{exp}(-k\theta) \lambda^{\sum_{i = k+1}^n y_i}\text{exp}(-(n-k)\lambda)\\
\pi(k|y_1,\dots,y_n,\theta,\lambda) &amp;\propto f(y_1,\dots,y_n|\theta,\lambda,k) \pi(k|n) \\
&amp;\propto \frac{1}{n} \frac{1}{\prod_{i = 1}^n y_i!}\theta^{\sum_{i = 1}^k y_i}\text{exp}(-k\theta) \lambda^{\sum_{i = k+1}^n y_i}\text{exp}(-(n-k)\lambda) \\
&amp;\propto \theta^{\sum_{i = 1}^k y_i}\text{exp}(-k\theta) \lambda^{\sum_{i = k+1}^n y_i}\text{exp}(k\lambda)\\
\\
p(\beta_1|\theta) &amp; = \pi(\theta|a_1,\beta_1)\pi(\beta_1|c_1,d_1)    \propto \theta^{a_1 - 1} IG\bigg(\beta_1;a_1 + c_1, \bigg(\frac{d_1\theta + 1}{d_1}\bigg)\bigg)\\
\int p(\beta_1|\theta) d \beta_1 &amp;\propto  \theta^{a_1 - 1} \int IG\bigg(\beta_1;a_1 + c_1, \bigg(\frac{d_1\theta + 1}{d_1}\bigg)\bigg) d \beta_1 = \theta^{a_1 - 1} \\
p(\beta_2 | \lambda) &amp; = \pi(\lambda|a_2,\beta_2) \pi(\beta_2|c_2,d_2) \propto \lambda^{a_2 - 1} IG\bigg(\beta_2; a_2 + c_2,\bigg(\frac{d_2\lambda+1}{d_2}\bigg)\bigg) \\
\int p(\beta_2 | \lambda) d \beta_2 &amp; \propto \lambda^{a_2 - 1} \int IG\bigg(\beta_2; a_2 + c_2,\bigg(\frac{d_2\lambda+1}{d_2}\bigg)\bigg) d \beta_2  = \lambda^{a_2 - 1}\\
\\
\pi(k|y_1,\dots,y_n) &amp;\propto \int \pi(k,\theta,\lambda,\beta_1,\beta_2|y_1,\dots,y_n) d\theta d\lambda d\beta_1 d\beta_2  \\
&amp;= \int f(y_1,\dots,y_n|\theta,\lambda) \pi(\theta|a_1,\beta_1) \pi(\lambda|a_2,\beta_2) \pi(\beta_1|c_1,d_1) \pi(\beta_2|c_2,d_2) \pi(k|n) d\theta d\lambda d\beta_1 d\beta_2  \\
&amp;\propto   \int \frac{1}{n} \frac{\theta^{\sum_{i = 1}^k y_i}\text{exp}(-k\theta)}{\prod_{i = 1}^k y_i!} \frac{\lambda^{\sum_{i = k+1}^n y_i}\text{exp}(-(n-k)\lambda)}{\prod_{i = k+1}^n y_i!} \theta^{a_1 - 1} \lambda^{a_2 - 1} d \theta d \lambda \\
&amp;=   \frac{1}{n\prod_{i = 1}^n y_i!} \int \theta^{a_1 + \sum_{i = 1}^k y_i - 1}\text{exp}(-k\theta) d \theta \int \lambda^{a_2 + \sum_{i = k+1}^n y_i - 1}\text{exp}(-(n-k)\lambda) d \lambda \\
&amp;=   \frac{1}{n\prod_{i = 1}^n y_i!} \frac{\Gamma(a_1 + \sum_{i = 1}^k y_i)} {k^{a_1 + \sum_{i = 1}^k y_i}} \frac{\Gamma(a_2 + \sum_{i = k+1}^n y_i)}{(n-k)^{a_2 + \sum_{i = k+1}^n y_i}}\\
\end{align*}</span>
<p>I could not find a common distribution for this marginal distribution of k.<br>
To implement this prior on k I implemented a metropolis hastings step to draw k. I used the discrete uniform distribution as the proposal distribution. The acceptance rate is not the best around 5%, but it seems to work well.</p>
<p>I did not notice too much difference in the distribution/histograms of R after introduction k as unknown. The posterior summaries also do not change by any very noticeable difference, so the introduction as k as an unknown parameter did not effect the posterior of R very much. (Table 2 and Table 3)</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sim settings</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7330</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> T<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># prior settings</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># data settings</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> coal.miners<span class="sc">$</span>disasters</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># setting initial values</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>theta_initial <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>lambda_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>R_initial <span class="ot">&lt;-</span> theta_initial<span class="sc">/</span>lambda_initial</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>beta1_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>beta2_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>k_initial <span class="ot">&lt;-</span> n</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>acceptk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_initial</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> lambda_initial</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> R_initial</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> beta1_initial</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">&lt;-</span> beta2_initial</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> k_initial</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># initializing storage</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>theta_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>lambda_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>R_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>beta1_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>beta2_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>k_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>klike <span class="ot">&lt;-</span> <span class="cf">function</span>(y,k,theta,lambda) {</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special cases of k</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">==</span> <span class="fu">length</span>(y)) {</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(theta<span class="sc">^</span>(<span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>k<span class="sc">*</span>theta) )</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(k <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( lambda<span class="sc">^</span>(<span class="fu">sum</span>(y[(k)<span class="sc">:</span>n])) <span class="sc">*</span> <span class="fu">exp</span>(k<span class="sc">*</span>lambda) )</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(theta<span class="sc">^</span>(<span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>k<span class="sc">*</span>theta) <span class="sc">*</span> lambda<span class="sc">^</span>(<span class="fu">sum</span>(y[(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n])) <span class="sc">*</span> <span class="fu">exp</span>(k<span class="sc">*</span>lambda) )</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="co"># gibbs sampler </span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(B<span class="sc">+</span>T)){</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special cases for k</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">==</span> n) {</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    n1 <span class="ot">&lt;-</span> k</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    y1. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    y2. <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (k <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    n1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    y1. <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    y2. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>n])</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    n1 <span class="ot">&lt;-</span> k</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n<span class="sc">-</span>k</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    y1. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    y2. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n])</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw theta</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>  theta_shape <span class="ot">&lt;-</span> a1 <span class="sc">+</span> y1.</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>  theta_rate <span class="ot">&lt;-</span> (k<span class="sc">*</span>beta1 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta1</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  theta <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> theta_shape,<span class="at">rate =</span> theta_rate)</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw lambda</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  lambda_shape <span class="ot">&lt;-</span> a2 <span class="sc">+</span> y2.</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  lambda_rate <span class="ot">&lt;-</span> (n2<span class="sc">*</span>beta2 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta2</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> lambda_shape,<span class="at">rate =</span> lambda_rate)</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw beta1</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  beta1_shape <span class="ot">&lt;-</span> a1 <span class="sc">+</span> c1</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>  beta1_rate <span class="ot">&lt;-</span> (d1<span class="sc">*</span>theta <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>d1</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>  beta1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> beta1_shape,<span class="at">rate =</span> beta1_rate)</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw beta2</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>  beta2_shape <span class="ot">&lt;-</span> a2 <span class="sc">+</span> c2</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>  beta2_rate <span class="ot">&lt;-</span> (d2<span class="sc">*</span>lambda <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>d2</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>  beta2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> beta2_shape,<span class="at">rate =</span> beta2_rate)</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw k by mH</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># proposal dist is discrete uniform</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>  k_star <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n,<span class="dv">1</span>,<span class="at">replace =</span> T)</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>  rk <span class="ot">&lt;-</span> <span class="fu">klike</span>(y,k_star,theta,lambda) <span class="sc">/</span> <span class="fu">klike</span>(y,k,theta,lambda)</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(rk <span class="sc">&gt;=</span> u) {</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k_star</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>    acceptk <span class="ot">&lt;-</span> acceptk<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store results</span></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>  theta_store[t] <span class="ot">&lt;-</span> theta</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>  lambda_store[t] <span class="ot">&lt;-</span> lambda</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>  R_store[t] <span class="ot">&lt;-</span> theta<span class="sc">/</span>lambda</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>  beta1_store[t] <span class="ot">&lt;-</span> beta1</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>  beta2_store[t] <span class="ot">&lt;-</span> beta2</span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>  k_store[t] <span class="ot">&lt;-</span> k</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics theta</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>post.theta.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>post.theta.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>post.theta.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>post.theta.min <span class="ot">&lt;-</span> <span class="fu">min</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>post.theta.max <span class="ot">&lt;-</span> <span class="fu">max</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>post.theta.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>post.theta.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics lambda</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>post.lambda.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>post.lambda.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>post.lambda.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>post.lambda.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>post.lambda.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>post.lambda.min <span class="ot">&lt;-</span> <span class="fu">min</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>post.lambda.max <span class="ot">&lt;-</span> <span class="fu">max</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics R</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>post.R.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>post.R.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>post.R.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>post.R.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>post.R.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>post.R.min <span class="ot">&lt;-</span> <span class="fu">min</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>post.R.max <span class="ot">&lt;-</span> <span class="fu">max</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics k</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>post.k.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>post.k.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>post.k.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>post.k.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>post.k.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>post.k.min <span class="ot">&lt;-</span> <span class="fu">min</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>post.k.max <span class="ot">&lt;-</span> <span class="fu">max</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics beta1</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>post.beta1.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>post.beta1.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>post.beta1.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>post.beta1.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>post.beta1.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>post.beta1.min <span class="ot">&lt;-</span> <span class="fu">min</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>post.beta1.max <span class="ot">&lt;-</span> <span class="fu">max</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics beta2</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>post.beta2.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>post.beta2.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>post.beta2.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>post.beta2.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>post.beta2.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>post.beta2.min <span class="ot">&lt;-</span> <span class="fu">min</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>post.beta2.max <span class="ot">&lt;-</span> <span class="fu">max</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor convergence</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">cbind</span> (<span class="fu">c</span>( theta_initial , theta_store ) , <span class="fu">c</span>( lambda_initial , lambda_store ) ) , <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>) , <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="fu">expression</span> ( theta ) , <span class="at">ylab =</span> <span class="fu">expression</span> ( lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( theta_initial , theta_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span> ( theta ), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( lambda_initial , lambda_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( R_initial , R_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( <span class="at">R =</span> theta<span class="sc">/</span>lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( k_initial , k_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( k ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( beta1_initial , beta1_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( beta1 ) , <span class="at">las =</span> <span class="dv">1</span>,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1500</span>))</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( beta2_initial , beta2_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( beta2 ) , <span class="at">las =</span> <span class="dv">1</span>,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.3%20k%20trace-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the joint and marginal posterior</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(MASS)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># contour</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">kde2d</span> ( theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)] , lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(z , <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">3.75</span>) , <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>) , <span class="at">las =</span> <span class="dv">1</span>, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">expression</span> ( theta ) , <span class="at">ylab =</span><span class="fu">expression</span> ( lambda ) )</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># theta hist</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span> , <span class="at">xlab =</span> <span class="fu">expression</span>( theta ), <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.theta.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.theta.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.theta.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.theta.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.theta.lower.cl,post.theta.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda hist</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="fu">expression</span>( lambda ), <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.lambda.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.lambda.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.lambda.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.lambda.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.lambda.lower.cl,post.lambda.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># R hist</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="fu">expression</span>( <span class="at">R =</span> theta<span class="sc">/</span> lambda ), <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.R.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.R.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.R.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.R.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.R.lower.cl,post.R.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co"># k hist</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"k"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.k.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.k.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.k.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.k.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.k.lower.cl,post.k.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co"># beta1 hist</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"beta1"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.beta1.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.beta1.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.beta1.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.beta1.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.beta1.lower.cl,post.beta1.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co"># beta2 hist</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"beta2"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.beta2.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.beta2.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.beta2.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.beta2.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.beta2.lower.cl,post.beta2.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.3%20k%20hist-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary table </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>post.theta.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.theta.min,<span class="dv">5</span>),<span class="fu">round</span>(post.theta.meadian,<span class="dv">5</span>),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.theta.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.theta.sd,<span class="dv">5</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.theta.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">round</span>(post.theta.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>), </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.theta.max,<span class="dv">5</span>))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>post.lambda.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.lambda.min,<span class="dv">5</span>),<span class="fu">round</span>(post.lambda.meadian,<span class="dv">5</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">round</span>(post.lambda.mean,<span class="dv">5</span>), <span class="fu">round</span>(post.lambda.sd,<span class="dv">5</span>),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.lambda.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">round</span>(post.lambda.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">round</span>(post.lambda.max,<span class="dv">5</span>))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>post.R.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.R.min,<span class="dv">5</span>),<span class="fu">round</span>(post.R.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.R.mean,<span class="dv">5</span>), <span class="fu">round</span>(post.R.sd,<span class="dv">5</span>),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.R.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.R.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.R.max,<span class="dv">5</span>))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>post.k.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.k.min,<span class="dv">5</span>),<span class="fu">round</span>(post.k.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.k.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.k.sd,<span class="dv">5</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.k.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.k.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.k.max,<span class="dv">5</span>))</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>post.beta1.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.beta1.min,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.sd,<span class="dv">5</span>),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.beta1.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.beta1.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.beta1.max,<span class="dv">5</span>))</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>post.beta2.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.beta2.min,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.sd,<span class="dv">5</span>),</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.beta2.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.beta2.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.beta2.max,<span class="dv">5</span>))</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>table.q22 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(post.theta.summary,post.lambda.summary,post.R.summary,post.k.summary,post.beta1.summary,post.beta2.summary))</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table.q22) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"theta"</span>,<span class="st">"lambda"</span>,<span class="st">"R"</span>,<span class="st">"k"</span>,<span class="st">"beta1"</span>,<span class="st">"beta2"</span>)<span class="co">#paste("$",c("\\theta","\\lambda","R"),"$",sep = "")</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#c("$\\theta$","$\\lambda$","$R = \\theta/\\lambda$")</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table.q22,<span class="at">booktabs =</span> T,<span class="at">format =</span> <span class="st">"pandoc"</span>,<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Posterior Min"</span>,<span class="st">"Posterior Median"</span>,<span class="st">"Posterior Mean"</span>,<span class="st">"Posterior sd"</span>, <span class="st">"95% Credible interval"</span>,<span class="st">"Posterior Max"</span>),<span class="at">caption =</span> <span class="st">"Posterior Summary Statistics of $</span><span class="sc">\\</span><span class="st">theta,</span><span class="sc">\\</span><span class="st">lambda,R = </span><span class="sc">\\</span><span class="st">theta / </span><span class="sc">\\</span><span class="st">lambda$, k, $</span><span class="sc">\\</span><span class="st">beta_1$, $</span><span class="sc">\\</span><span class="st">beta_2$"</span>, <span class="at">align =</span> <span class="st">"cccccc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>,<span class="st">"scale_down"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Posterior Summary Statistics of <span class="math inline">\theta,\lambda,R = \theta / \lambda</span>, k, <span class="math inline">\beta_1</span>, <span class="math inline">\beta_2</span></caption>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Posterior Min</th>
<th style="text-align: center;">Posterior Median</th>
<th style="text-align: center;">Posterior Mean</th>
<th style="text-align: center;">Posterior sd</th>
<th style="text-align: center;">95% Credible interval</th>
<th style="text-align: center;">Posterior Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>theta</td>
<td style="text-align: center;">2.11694</td>
<td style="text-align: center;">3.08392</td>
<td style="text-align: center;">3.09412</td>
<td style="text-align: center;">0.2894</td>
<td style="text-align: center;">( 2.55353 , 3.69666 )</td>
<td style="text-align: center;">4.27808</td>
</tr>
<tr class="even">
<td>lambda</td>
<td style="text-align: center;">0.49245</td>
<td style="text-align: center;">0.91157</td>
<td style="text-align: center;">0.91559</td>
<td style="text-align: center;">0.11678</td>
<td style="text-align: center;">( 0.7026 , 1.15938 )</td>
<td style="text-align: center;">1.54862</td>
</tr>
<tr class="odd">
<td>R</td>
<td style="text-align: center;">1.91515</td>
<td style="text-align: center;">3.38284</td>
<td style="text-align: center;">3.4337</td>
<td style="text-align: center;">0.54097</td>
<td style="text-align: center;">( 2.5102 , 4.61203 )</td>
<td style="text-align: center;">6.88399</td>
</tr>
<tr class="even">
<td>k</td>
<td style="text-align: center;">31</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">40.3128</td>
<td style="text-align: center;">2.38561</td>
<td style="text-align: center;">( 36 , 46 )</td>
<td style="text-align: center;">48</td>
</tr>
<tr class="odd">
<td>beta1</td>
<td style="text-align: center;">0.3702</td>
<td style="text-align: center;">3.49433</td>
<td style="text-align: center;">10.33666</td>
<td style="text-align: center;">238.62555</td>
<td style="text-align: center;">( 0.86817 , 41.33843 )</td>
<td style="text-align: center;">23722.17797</td>
</tr>
<tr class="even">
<td>beta2</td>
<td style="text-align: center;">0.17642</td>
<td style="text-align: center;">1.60593</td>
<td style="text-align: center;">7.05171</td>
<td style="text-align: center;">332.05212</td>
<td style="text-align: center;">( 0.41084 , 18.77722 )</td>
<td style="text-align: center;">33184.11718</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="question-2.4-10-points" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="question-2.4-10-points"><span class="header-section-number">2.4</span> Question 2.4 (10 points)</h2>
<p>Now replace the third-stage priors given above with, <span class="math inline">\beta_1 \sim Ga(c_1,d_1)</span> and <span class="math inline">\beta_2 \sim Ga(c_2,d_2)</span> with <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span> being independent, thus destroying the conjugacy for these two conditionals. Resort to a Metropolis Hastings subsampling for these two components instead, using the following hyperparameter values <span class="math inline">c_1 = c_2 = 1</span> and <span class="math inline">d_1 = d_2 = 100</span>. What is the effect on the posterior distribution for <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span>. For <span class="math inline">R = \theta/\lambda</span>? For <span class="math inline">k</span>?</p>
<span class="math display">\begin{align*}
\pi(\theta|a_1,\beta_1) &amp;= \frac{1}{\beta_1^{a_1}\Gamma(a_1)}\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \\
\pi(\lambda|a_2,\beta_2) &amp;= \frac{1}{\beta_2^{a_2}\Gamma(a_2)}\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg) \\
\pi(\beta_1|c_1,d_1) &amp;= \frac{1}{d_1^{c_1}\Gamma(c_1)}\beta_1^{c_1 - 1}\text{exp}\bigg(-\frac{\beta_1}{d_1}\bigg) \\
\pi(\beta_2|c_2,d_2) &amp;= \frac{1}{d_2^{c_2}\Gamma(c_2)}\beta_2^{c_2 - 1}\text{exp}\bigg(-\frac{\beta_2}{d_2}\bigg) \\
\pi(k|n) &amp;= \frac{1}{n} \\
f(y_1,\dots,y_n|\theta,\lambda,k) &amp;= \prod_{i = 1}^k \frac{\theta^{y_i}\text{exp}(-\theta)}{y_i!}\prod_{i = k+1}^n \frac{\lambda^{y_i}\text{exp}(-\lambda)}{y_i!}\\
\\
\pi(\beta_1|\theta) &amp;\propto \pi(\theta|a_1,\beta_1) \pi(\beta_1|c_1,d_1) \\
&amp;=  \frac{1}{\beta_1^{a_1}\Gamma(a_1)}\theta^{a_1 - 1}\text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \frac{1}{d_1^{c_1}\Gamma(c_1)}\beta_1^{c_1 - 1}\text{exp}\bigg(-\frac{\beta_1}{d_1}\bigg)\\
&amp;\propto \frac{1}{\beta_1^{a_1}} \text{exp}\bigg(-\frac{\theta}{\beta_1}\bigg) \beta_1^{c_1 - 1}\text{exp}\bigg(-\frac{\beta_1}{d_1}\bigg) \\  
&amp;= \beta_1^{c_1 - a_1 - 1} \text{exp}\bigg(-\frac{\theta}{\beta_1}-\frac{\beta_1}{d_1}\bigg) \\  
\\
\pi(\beta_2|\lambda) &amp;\propto \pi(\lambda|a_2,\beta_2) \pi(\beta_2|c_2,d_2) \\
&amp;= \frac{1}{\beta_2^{a_2}\Gamma(a_2)}\lambda^{a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg)\frac{1}{d_2^{c_2}\Gamma(c_2)}\beta_2^{c_2 - 1}\text{exp}\bigg(-\frac{\beta_2}{d_2}\bigg) \\
&amp;\propto \beta_2^{-a_2}\text{exp}\bigg(-\frac{\lambda}{\beta_2}\bigg) \beta_2^{c_2 - 1}\text{exp}\bigg(-\frac{\beta_2}{d_2}\bigg)\\
&amp;= \beta_2^{c_2 - a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}-\frac{\beta_2}{d_2}\bigg)\\
\\
\pi(\beta_1,\beta_2|\theta,\lambda) &amp;\propto \beta_1^{c_1 - a_1 - 1} \text{exp}\bigg(-\frac{\theta}{\beta_1}-\frac{\beta_1}{d_1}\bigg) \beta_2^{c_2 - a_2 - 1}\text{exp}\bigg(-\frac{\lambda}{\beta_2}-\frac{\beta_2}{d_2}\bigg)\\
&amp;= \beta_1^{c_1 - a_1 - 1}\beta_2^{c_2 - a_2 - 1} \text{exp}\bigg(-\frac{\theta}{\beta_1}-\frac{\beta_1}{d_1}-\frac{\lambda}{\beta_2}-\frac{\beta_2}{d_2}\bigg)\\
%log(\pi(\beta_1,\beta_2|\theta,\lambda)) &amp;\propto  (c_1 - a_1 - 1)log(\beta_1) + (c_2 - a_2 - 1)log(\beta_2) -\frac{\theta}{\beta_1}-\frac{\beta_1}{d_1}-\frac{\lambda}{\beta_2}-\frac{\beta_2}{d_2}\\
\text{proposal dist: }&amp;\\
J( (\beta_1^{*},
\beta_2^{*}) | (\beta_1^{(t-1)},\beta_2^{(t-1)})) &amp;\sim
MN \bigg(((\beta_1^{*},
\beta_2^{*})); (\beta_1^{(t-1)},\beta_2^{(t-1)}),\bigg( \begin{matrix} \psi_{\beta_1}^2 &amp; 0 \\ 0 &amp; \psi_{\beta_2}^2   \end{matrix} \bigg)\bigg)\\
\end{align*}</span>
<p>The posterior distributions of <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span> are both much narrower that in the previous sampling setting, and noticeably lower parameter estimates. One thing to note is that to me it looks like both <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span> are not converging, so this may impact any inferences done on these two parameters. I tried different proposal distributions and different sampling settings, but could not achieve any noticeable convergence. This may indicate that I have derived my posterior incorrectly, but I could not figure out where the issue is. The histograms are more bell shaped than before using the inverse gamma prior.</p>
<p>For the effect on <span class="math inline">R =\theta/\lambda</span> the coverage is slightly narrower, but other than that there is not too much change from table 3 to table 4 and the histograms. This may be a part of the convergence issue of <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span> or this may indicate that the prior choice of <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span> has minimal change in the posterior estimates of R.</p>
<p>For the effect on k the range is slightly larger, but the median and coverage does not change. There is a slightly lower posterior mean for k. Overall, there seems to be little effect on the posterior of k using that improper prior Gamma for <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span> again there may be some issues because of the convergence problem of <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sim settings</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7330</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> T<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># prior settings</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>psi_beta1 <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>psi_beta2 <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># data settings</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> coal.miners<span class="sc">$</span>disasters</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># setting initial values</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>theta_initial <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>lambda_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>R_initial <span class="ot">&lt;-</span> theta_initial<span class="sc">/</span>lambda_initial</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>beta1_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>beta2_initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>k_initial <span class="ot">&lt;-</span> n</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>acceptk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>acceptbeta <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_initial</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> lambda_initial</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> R_initial</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> beta1_initial</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">&lt;-</span> beta2_initial</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> k_initial</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># initializing storage</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>theta_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>lambda_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>R_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>beta1_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>beta2_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>k_store <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>r_store <span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>rk_store <span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="cn">NA</span>,T<span class="sc">+</span>B)</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>klike <span class="ot">&lt;-</span> <span class="cf">function</span>(y,k,theta,lambda) {</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special cases of k</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">==</span> <span class="fu">length</span>(y)) {</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(theta<span class="sc">^</span>(<span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>k<span class="sc">*</span>theta) )</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(k <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( lambda<span class="sc">^</span>(<span class="fu">sum</span>(y[(k)<span class="sc">:</span>n])) <span class="sc">*</span> <span class="fu">exp</span>(k<span class="sc">*</span>lambda) )</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(theta<span class="sc">^</span>(<span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>k<span class="sc">*</span>theta) <span class="sc">*</span> lambda<span class="sc">^</span>(<span class="fu">sum</span>(y[(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n])) <span class="sc">*</span> <span class="fu">exp</span>(k<span class="sc">*</span>lambda) )</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="co"># logpost for MH for beta 1 and 2</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="cf">function</span>(beta1,beta2,theta,lambda,a1,a2,c1,c2,d1,d2) {</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( beta1<span class="sc">^</span>(c1 <span class="sc">-</span> a1 <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>beta2<span class="sc">^</span>(c2 <span class="sc">-</span> a2 <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span> theta<span class="sc">/</span>beta1 <span class="sc">-</span> beta1<span class="sc">/</span>d1 <span class="sc">-</span> lambda<span class="sc">/</span>beta2 <span class="sc">-</span> beta2<span class="sc">/</span>d2))</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="co"># gibbs sampler </span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(B<span class="sc">+</span>T)){</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a> <span class="co"># for( i in 1:1){</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special cases for k</span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">==</span> n) {</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    n1 <span class="ot">&lt;-</span> k</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>    y1. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>    y2. <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (k <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>    n1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>    y1. <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>    y2. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>n])</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>    n1 <span class="ot">&lt;-</span> k</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n<span class="sc">-</span>k</span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>    y1. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[<span class="dv">1</span><span class="sc">:</span>k])</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>    y2. <span class="ot">&lt;-</span> <span class="fu">sum</span>(y[(k<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n])</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw theta</span></span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>  theta_shape <span class="ot">&lt;-</span> a1 <span class="sc">+</span> y1.</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>  theta_rate <span class="ot">&lt;-</span> (k<span class="sc">*</span>beta1 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta1</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>  theta <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> theta_shape,<span class="at">rate =</span> theta_rate)</span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw lambda</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>  lambda_shape <span class="ot">&lt;-</span> a2 <span class="sc">+</span> y2.</span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>  lambda_rate <span class="ot">&lt;-</span> (n2<span class="sc">*</span>beta2 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span>beta2</span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape =</span> lambda_shape,<span class="at">rate =</span> lambda_rate)</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># metropolis- hastings beta1 and beta2</span></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>  beta1_star <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span> beta1,<span class="at">sd =</span> psi_beta1)</span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>  beta2_star <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span> beta2,<span class="at">sd =</span> psi_beta2)</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">post</span>(beta1_star,beta2_star,theta,lambda,a1,a2,c1,c2,d1,d2) <span class="sc">/</span> <span class="fu">post</span>(beta1,beta2,theta,lambda,a1,a2,c1,c2,d1,d2)</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>  u1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>,<span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(r <span class="sc">&gt;=</span> u1) {</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>    beta1 <span class="ot">&lt;-</span> beta1_star</span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>    beta2 <span class="ot">&lt;-</span> beta2_star</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>    acceptbeta <span class="ot">&lt;-</span> acceptbeta <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw k by mH</span></span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># proposal dist is discrete uniform</span></span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>  k_star <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n,<span class="dv">1</span>,<span class="at">replace =</span> T)</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>  rk <span class="ot">&lt;-</span> <span class="fu">klike</span>(y,k_star,theta,lambda) <span class="sc">/</span> <span class="fu">klike</span>(y,k,theta,lambda)</span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>  rk_store[t] <span class="ot">&lt;-</span> rk</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>  u2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(rk <span class="sc">&gt;=</span> u2) {</span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k_star</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>    acceptk <span class="ot">&lt;-</span> acceptk<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a> <span class="co"># }</span></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store results</span></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>  theta_store[t] <span class="ot">&lt;-</span> theta</span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>  lambda_store[t] <span class="ot">&lt;-</span> lambda</span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>  R_store[t] <span class="ot">&lt;-</span> theta<span class="sc">/</span>lambda</span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>  beta1_store[t] <span class="ot">&lt;-</span> beta1</span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a>  beta2_store[t] <span class="ot">&lt;-</span> beta2</span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>  k_store[t] <span class="ot">&lt;-</span> k</span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics theta</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>post.theta.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>post.theta.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>post.theta.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>post.theta.min <span class="ot">&lt;-</span> <span class="fu">min</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>post.theta.max <span class="ot">&lt;-</span> <span class="fu">max</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>post.theta.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>post.theta.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics lambda</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>post.lambda.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>post.lambda.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>post.lambda.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>post.lambda.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>post.lambda.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>post.lambda.min <span class="ot">&lt;-</span> <span class="fu">min</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>post.lambda.max <span class="ot">&lt;-</span> <span class="fu">max</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics R</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>post.R.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>post.R.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>post.R.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>post.R.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>post.R.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>post.R.min <span class="ot">&lt;-</span> <span class="fu">min</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>post.R.max <span class="ot">&lt;-</span> <span class="fu">max</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics k</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>post.k.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>post.k.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>post.k.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>post.k.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>post.k.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>post.k.min <span class="ot">&lt;-</span> <span class="fu">min</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>post.k.max <span class="ot">&lt;-</span> <span class="fu">max</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics beta1</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>post.beta1.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>post.beta1.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>post.beta1.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>post.beta1.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>post.beta1.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>post.beta1.min <span class="ot">&lt;-</span> <span class="fu">min</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>post.beta1.max <span class="ot">&lt;-</span> <span class="fu">max</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="co"># calc posterior summary statistics beta2</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>post.beta2.meadian <span class="ot">&lt;-</span> <span class="fu">median</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>post.beta2.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>post.beta2.sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>post.beta2.lower.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>post.beta2.upper.cl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)],<span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>post.beta2.min <span class="ot">&lt;-</span> <span class="fu">min</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>post.beta2.max <span class="ot">&lt;-</span> <span class="fu">max</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor convergence</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">cbind</span> (<span class="fu">c</span>( theta_initial , theta_store ) , <span class="fu">c</span>( lambda_initial , lambda_store ) ) , <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>) , <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="fu">expression</span> ( theta ) , <span class="at">ylab =</span> <span class="fu">expression</span> ( lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( theta_initial , theta_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span> ( theta ), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( lambda_initial , lambda_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( R_initial , R_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( <span class="at">R =</span> theta<span class="sc">/</span>lambda ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( k_initial , k_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( k ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( beta1_initial , beta1_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( beta1 ) , <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>( beta2_initial , beta2_store ) , <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">" Iteration "</span>, <span class="at">ylab =</span> <span class="fu">expression</span>( beta2 ) , <span class="at">las =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.4%20beta12%20trace-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the joint and marginal posterior</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(MASS)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># contour</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">kde2d</span> ( theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)] , lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(z , <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">3.75</span>) , <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>) , <span class="at">las =</span> <span class="dv">1</span>, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">expression</span> ( theta ) , <span class="at">ylab =</span><span class="fu">expression</span> ( lambda ) )</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># theta hist</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span> , <span class="at">xlab =</span> <span class="fu">expression</span>( theta ), <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.theta.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.theta.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.theta.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.theta.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.theta.lower.cl,post.theta.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(theta_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda hist</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="fu">expression</span>( lambda ), <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.lambda.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.lambda.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.lambda.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.lambda.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.lambda.lower.cl,post.lambda.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(lambda_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># R hist</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="fu">expression</span>( <span class="at">R =</span> theta<span class="sc">/</span> lambda ), <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.R.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.R.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.R.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.R.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.R.lower.cl,post.R.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(R_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># k hist</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"k"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.k.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.k.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.k.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.k.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.k.lower.cl,post.k.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(k_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="co"># beta1 hist</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"beta1"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.beta1.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.beta1.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.beta1.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.beta1.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.beta1.lower.cl,post.beta1.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(beta1_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co"># beta2 hist</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"beta2"</span>, <span class="at">las =</span> <span class="dv">1</span>,   </span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">" Post.mean = "</span>, <span class="fu">round</span>(post.beta2.mean, <span class="dv">2</span>), <span class="st">", CI = ["</span>, <span class="fu">round</span>(post.beta2.lower.cl ,<span class="dv">2</span>), <span class="st">","</span>,<span class="fu">round</span>(post.beta2.upper.cl,<span class="dv">2</span>), <span class="st">"]"</span>) , <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> post.beta2.mean , <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span> ( <span class="at">v =</span> <span class="fu">c</span>(post.beta2.lower.cl,post.beta2.upper.cl) , <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(beta2_store[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(B<span class="sc">+</span>T)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Bayesian-Final-Exam_files/figure-html/q2.4%20beta12%20hist-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary table </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>post.theta.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.theta.min,<span class="dv">5</span>),<span class="fu">round</span>(post.theta.meadian,<span class="dv">5</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.theta.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.theta.sd,<span class="dv">5</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.theta.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">round</span>(post.theta.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>), </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.theta.max,<span class="dv">5</span>))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>post.lambda.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.lambda.min,<span class="dv">5</span>),<span class="fu">round</span>(post.lambda.meadian,<span class="dv">5</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">round</span>(post.lambda.mean,<span class="dv">5</span>), <span class="fu">round</span>(post.lambda.sd,<span class="dv">5</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.lambda.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">round</span>(post.lambda.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">round</span>(post.lambda.max,<span class="dv">5</span>))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>post.R.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.R.min,<span class="dv">5</span>),<span class="fu">round</span>(post.R.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.R.mean,<span class="dv">5</span>), <span class="fu">round</span>(post.R.sd,<span class="dv">5</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.R.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.R.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.R.max,<span class="dv">5</span>))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>post.k.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.k.min,<span class="dv">5</span>),<span class="fu">round</span>(post.k.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.k.mean,<span class="dv">5</span>),<span class="fu">round</span>(post.k.sd,<span class="dv">5</span>),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.k.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.k.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.k.max,<span class="dv">5</span>))</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>post.beta1.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.beta1.min,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.beta1.mean,<span class="dv">5</span>),</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.beta1.sd,<span class="dv">5</span>),</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.beta1.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.beta1.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.beta1.max,<span class="dv">5</span>))</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>post.beta2.summary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(post.beta2.min,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.meadian,<span class="dv">5</span>),<span class="fu">round</span>(post.beta2.mean,<span class="dv">5</span>),</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">round</span>(post.beta2.sd,<span class="dv">5</span>),</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste</span>(<span class="st">"("</span>,<span class="fu">round</span>(post.beta2.lower.cl,<span class="dv">5</span>),<span class="st">","</span>,<span class="fu">round</span>(post.beta2.upper.cl,<span class="dv">5</span>),<span class="st">")"</span>),</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">round</span>(post.beta2.max,<span class="dv">5</span>))</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>table.q22 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(post.theta.summary,post.lambda.summary,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>                                 post.R.summary,post.k.summary,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>                                 post.beta1.summary,post.beta2.summary))</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table.q22) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"theta"</span>,<span class="st">"lambda"</span>,<span class="st">"R"</span>,<span class="st">"k"</span>,<span class="st">"beta1"</span>,<span class="st">"beta2"</span>)<span class="co">#paste("$",c("\\theta","\\lambda","R"),"$",sep = "")</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#c("$\\theta$","$\\lambda$","$R = \\theta/\\lambda$")</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table.q22,<span class="at">booktabs =</span> T,<span class="at">format =</span> <span class="st">"pandoc"</span>,<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Posterior Min"</span>,<span class="st">"Posterior Median"</span>,<span class="st">"Posterior Mean"</span>,<span class="st">"Posterior sd"</span>, <span class="st">"95% Credible interval"</span>,<span class="st">"Posterior Max"</span>),<span class="at">caption =</span> <span class="st">"Posterior Summary Statistics of $</span><span class="sc">\\</span><span class="st">theta,</span><span class="sc">\\</span><span class="st">lambda,R = </span><span class="sc">\\</span><span class="st">theta / </span><span class="sc">\\</span><span class="st">lambda$, k, $</span><span class="sc">\\</span><span class="st">beta_1$, $</span><span class="sc">\\</span><span class="st">beta_2$"</span>, <span class="at">align =</span> <span class="st">"cccccc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>,<span class="st">"scale_down"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Posterior Summary Statistics of <span class="math inline">\theta,\lambda,R = \theta / \lambda</span>, k, <span class="math inline">\beta_1</span>, <span class="math inline">\beta_2</span></caption>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Posterior Min</th>
<th style="text-align: center;">Posterior Median</th>
<th style="text-align: center;">Posterior Mean</th>
<th style="text-align: center;">Posterior sd</th>
<th style="text-align: center;">95% Credible interval</th>
<th style="text-align: center;">Posterior Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>theta</td>
<td style="text-align: center;">2.20264</td>
<td style="text-align: center;">3.10523</td>
<td style="text-align: center;">3.11349</td>
<td style="text-align: center;">0.29188</td>
<td style="text-align: center;">( 2.56977 , 3.72504 )</td>
<td style="text-align: center;">4.43249</td>
</tr>
<tr class="even">
<td>lambda</td>
<td style="text-align: center;">0.52861</td>
<td style="text-align: center;">0.91713</td>
<td style="text-align: center;">0.92208</td>
<td style="text-align: center;">0.11809</td>
<td style="text-align: center;">( 0.70458 , 1.16551 )</td>
<td style="text-align: center;">1.38715</td>
</tr>
<tr class="odd">
<td>R</td>
<td style="text-align: center;">1.87189</td>
<td style="text-align: center;">3.38182</td>
<td style="text-align: center;">3.43041</td>
<td style="text-align: center;">0.53547</td>
<td style="text-align: center;">( 2.51964 , 4.59751 )</td>
<td style="text-align: center;">6.24889</td>
</tr>
<tr class="even">
<td>k</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">40.0984</td>
<td style="text-align: center;">2.44723</td>
<td style="text-align: center;">( 36 , 46 )</td>
<td style="text-align: center;">50</td>
</tr>
<tr class="odd">
<td>beta1</td>
<td style="text-align: center;">0.81342</td>
<td style="text-align: center;">4.69465</td>
<td style="text-align: center;">4.55587</td>
<td style="text-align: center;">1.80343</td>
<td style="text-align: center;">( 1.27229 , 7.58913 )</td>
<td style="text-align: center;">8.83001</td>
</tr>
<tr class="even">
<td>beta2</td>
<td style="text-align: center;">0.1677</td>
<td style="text-align: center;">2.78378</td>
<td style="text-align: center;">2.8749</td>
<td style="text-align: center;">1.47073</td>
<td style="text-align: center;">( 0.45902 , 6.11796 )</td>
<td style="text-align: center;">7.47165</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="problem-3-model-comparison-on-regression-models" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Problem 3: Model comparison on regression models</h1>
<p>For the following data we consider two competing models: <span class="math inline">H_1</span>: a linear vs.&nbsp;<span class="math inline">H_2</span>: a quadratic regression.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">x_i</span></td>
<td style="text-align: right;">-1.9</td>
<td style="text-align: right;">-0.39</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">-0.20</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">-0.35</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">-0.024</td>
<td style="text-align: right;">1.2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">y_i</span></td>
<td style="text-align: right;">-1.7</td>
<td style="text-align: right;">-0.23</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">-0.66</td>
<td style="text-align: right;">1.97</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">1.13</td>
<td style="text-align: right;">-0.943</td>
<td style="text-align: right;">2.6</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Model <span class="math inline">H_1</span>:</p>
<span class="math display">\begin{align*}
y_i &amp;= \beta_1 + \beta_2 x_i + \epsilon_i,\quad i = 1, \dots,n\\
\beta_1 &amp;\sim N(0,1)\\
\beta_2 &amp;\sim N(1,1) \\
\epsilon_i &amp;\sim N(0,1)\\
\end{align*}</span>
<p>with <span class="math inline">\beta_1</span> and <span class="math inline">\beta_2</span> a priori independent.</p>
<p>Model <span class="math inline">H_2</span>:<br>
</p>
<span class="math display">\begin{align*}
y_i &amp;= \gamma_1 + \gamma_2 x_i + \gamma_3 x_i^2 + \epsilon_i,\quad i = 1, \dots,n\\
\gamma_1,\gamma_3 &amp;\sim N(0,1)\\
\gamma_2 &amp;\sim N(1,1) \\
\epsilon_i &amp;\sim N(0,1)\\
\end{align*}</span>
<p>with <span class="math inline">\gamma_1</span>, <span class="math inline">\gamma_2</span>, and <span class="math inline">\gamma_3</span> a prior independent.</p>
<section id="question-3.1-7-points" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="question-3.1-7-points"><span class="header-section-number">3.1</span> Question 3.1 (7 points)</h2>
<p>Find the marginal distributions <span class="math inline">\pi(y_1,\dots,y_n|H_1) = \int f(y_1,\dots, y_n|\beta_1,\beta_2)\pi(\beta_1)\pi(\beta_2)d\beta_1 d\beta_2</span></p>
<span class="math display">\begin{align*}
\pi(y_1,\dots,y_n|H_1) =&amp; \int f(y_1,\dots, y_n|\beta_1,\beta_2)\pi(\beta_1)\pi(\beta_2)d\beta_1 d\beta_2\\
\text{Integrate out } \beta_1 :&amp;\\
p(\bm{y}|\beta_2)  =&amp; \int f(y_1,\dots, y_n|\beta_1,\beta_2)\pi(\beta_1)d\beta_1 \\
=&amp; \int N(y_1,\dots, y_n;\beta_1 1_n + \bm{x}\beta_2,I_n) N(\beta_1;0,1) d\beta_1\\
=&amp; \int (2\pi)^{-\frac{n}{2}}\text{exp}\bigg( -\frac{1}{2}(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2)^\top(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2) \bigg) (2\pi)^{-\frac{1}{2}}\text{exp}\bigg(-\frac{\beta_1^2}{2}\bigg) d \beta_1 \\
=&amp; (2\pi)^{-\frac{n+1}{2}}\int \text{exp}\bigg( -\frac{1}{2}(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2)^\top(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2) \bigg) \text{exp}\bigg(-\frac{\beta_1^2}{2}\bigg) d \beta_1 \\
=&amp; (2\pi)^{-\frac{n+1}{2}}\int \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top - n\beta_1^2 - \beta_2^2\bm{x}^\top\bm{x}\bigg)\text{exp}\bigg( \beta_1\bm{1}_n^\top\bm{y} - \beta_1\beta_2 \bm{1}_n^\top\bm{x} - \beta_2\bm{x}^\top\bm{y} \bigg) \text{exp}\bigg(-\frac{\beta_1^2}{2}\bigg) d \beta_1 \\
=&amp; (2\pi)^{-\frac{n+1}{2}} \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top)\bigg)\text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{x} +   \beta_2\bm{x}^\top\bm{y} \bigg) \int \text{exp}\bigg( -\frac{n+1}{2}\beta_1^2 + \bigg(\bm{1}_n^\top\bm{y} - \beta_2 \bm{1}_n^\top\bm{x}\bigg)\beta_1 \bigg) d\beta_1 \\
=&amp; (2\pi)^{-\frac{n+1}{2}} \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top)\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{x} +   \beta_2\bm{x}^\top\bm{y} \bigg) (2\pi)^{\frac{1}{2}}\bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \\
&amp;\text{exp} \bigg(  \frac{1}{2} \frac{1}{n+1} (\bm{y} - \beta_2\bm{x})^\top\bm{1}_n\bm{1}_n^\top(\bm{y} - \beta_2\bm{x})\bigg) \int N\bigg( \beta_1; \frac{1}{n+1}\bigg(\bm{1}_n^\top\bm{y} - \beta_2 \bm{1}_n^\top\bm{x}\bigg), \frac{1}{n+1}\bigg) d\beta_1 \\
=&amp; (2\pi)^{-\frac{n}{2}} \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top)\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{x} +   \beta_2\bm{x}^\top\bm{y} \bigg)  \\
&amp;\text{exp} \bigg(  \frac{1}{2} \frac{1}{n+1}\bm{y}^\top\bm{1}_n\bm{1}_n^\top\bm{y} + \frac{1}{2} \frac{1}{n+1} \beta_2^2\bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{x} - \frac{1}{n+1} \beta_2\bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{y} \bigg) \\
=&amp; (2\pi)^{-\frac{n}{2}} \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}(\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top)\bm{y}^\top\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top(\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top)\bm{x} +   \beta_2\bm{x}^\top(\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top)\bm{y} \bigg)  \\
=&amp; (2\pi)^{-\frac{n}{2}} \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{H}_n\bm{x} +   \beta_2\bm{x}^\top\bm{H}_n\bm{y} \bigg)  \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top \\
\\
\text{Integrate out } \beta_2 :&amp;\\
p(\bm{y}|H_1) =&amp; \int p(\bm{y}|\beta_2) p(\beta_2)d\beta_2  \\
=&amp; \int p(\bm{y}|\beta_2) N(\beta_2;1,1)d\beta_2  \\
=&amp; \int (2\pi)^{-\frac{n}{2}} \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{H}_n\bm{x} +   \beta_2\bm{x}^\top\bm{H}_n\bm{y} \bigg) \\
&amp;(2\pi)^{-\frac{1}{2}}\text{exp}\bigg(-\frac{(\beta_2 - 1)^2}{2}\bigg) d \beta_2 \\
=&amp; (2\pi)^{-\frac{n+1}{2}} \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \int   \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{H}_n\bm{x} +   \beta_2\bm{x}^\top\bm{H}_n\bm{y} \bigg) \\
&amp;\text{exp}\bigg(-\frac{\beta_2^2}{2} + \beta_2 - \frac{1}{2}\bigg) d \beta_2 \\
=&amp; (2\pi)^{-\frac{n+1}{2}} \text{exp}\bigg( -\frac{1}{2}\bigg) \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \int   \text{exp}\bigg( -\frac{1}{2} \beta_2^2(1+\bm{x}^\top\bm{H}_n\bm{x}) +   \beta_2(1 + \bm{x}^\top\bm{H}_n\bm{y}) \bigg) d \beta_2 \\
=&amp; (2\pi)^{-\frac{n+1}{2}} \text{exp}\bigg( -\frac{1}{2}\bigg) \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg)  \\
&amp; (2\pi)^{\frac{1}{2}} \bigg(\frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bigg)^{\frac{1}{2}} \text{exp}\bigg( \frac{1}{2}\frac{(1 + \bm{x}^\top\bm{H}_n\bm{y})^2}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bigg) \int N\bigg(\beta_2; \frac{1 + \bm{x}^\top\bm{H}_n\bm{y}}{1+\bm{x}^\top\bm{H}_n\bm{x}},\frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bigg) d \beta_2 \\
=&amp; (2\pi)^{-\frac{n}{2}} \text{exp}\bigg( -\frac{1}{2}\bigg) \bigg(\frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bigg)^{\frac{1}{2}} \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg)  \text{exp}\bigg( \frac{1}{2}\frac{(1 + \bm{x}^\top\bm{H}_n\bm{y})^\top(1 + \bm{x}^\top\bm{H}_n\bm{y})}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bigg) \\
=&amp; (2\pi)^{-\frac{n}{2}} \text{exp}\bigg( -\frac{1}{2}\bigg) \bigg(\frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bigg)^{\frac{1}{2}} \bigg( \frac{1}{n+1} \bigg)^{\frac{1}{2}} \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \\
&amp;\text{exp}\bigg( \frac{1}{2}\frac{\bm{y}^\top\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bm{y}}{1+\bm{x}^\top\bm{H}_n\bm{x}} + \frac{\bm{y}^\top\bm{H}_n^\top\bm{x}}{1+\bm{x}^\top\bm{H}_n\bm{x}} + \frac{1}{2} \bigg)\\
\propto&amp; \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top(\bm{H}_n - \frac{\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n}{1+\bm{x}^\top\bm{H}_n\bm{x}})\bm{y} + \frac{\bm{y}^\top\bm{H}_n^\top\bm{x}}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bigg) \\
\bm{y}|H_1 \sim&amp; MN\bigg( \bigg(\bm{H}_n - \frac{\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bigg)^{-1} \frac{\bm{H}_n^\top\bm{x}}{1+\bm{x}^\top\bm{H}_n\bm{x}}, \bigg(\bm{H}_n - \frac{\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bigg)^{-1}\bigg)\\
\\
\bm{y}|H_1 \sim&amp; MN \bigg(\bm{C}^{-1}\bm{u},  \bm{C}^{-1}  \bigg) \\
&amp;\text{where } \bm{C} = \bm{H}_n - \frac{\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n}{1+\bm{x}^\top\bm{H}_n\bm{x}} \\
&amp;\text{where } \bm{u} = \frac{\bm{H}_n^\top\bm{x}}{1+\bm{x}^\top\bm{H}_n\bm{x}} \\
\end{align*}</span>
</section>
<section id="question-3.2-7-points" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="question-3.2-7-points"><span class="header-section-number">3.2</span> Question 3.2 (7 points)</h2>
<p>Find the marginal distributions <span class="math inline">\pi(y_1,\dots,y_n|H_2) = \int f(y_1,\dots, y_n|\gamma_1,\gamma_2,\gamma_3)\pi(\gamma_1)\pi(\gamma_2)\pi(\gamma_3)d\gamma_1 d\gamma_2 d\gamma_3</span></p>
<span class="math display">\begin{align*}
\pi(y_1,\dots,y_n|H_2) =&amp; \int f(y_1,\dots, y_n|\gamma_1,\gamma_2,\gamma_3)\pi(\gamma_1)\pi(\gamma_2)\pi(\gamma_3)d\gamma_1 d\gamma_2 d\gamma_3 \\
\text{Integrate out }\gamma_1:&amp;\\
p(\bm{y}|\gamma_2,\gamma_3) =&amp; \int f(y_1,\dots, y_n|\gamma_1,\gamma_2,\gamma_3)\pi(\gamma_1) d \gamma_1 \\
=&amp; \int N (\bm{y}; \gamma_1 \bm{1}_n +  \gamma_2 \bm{x} + \gamma_3 \bm{x}\circ\bm{x},\bm{I}_n ) N(\gamma_1;0,1) d \gamma_1  \\
\propto&amp; \int \text{exp} \bigg( -\frac{1}{2} (\bm{y} - \gamma_1 \bm{1}_n -  \gamma_2 \bm{x} - \gamma_3 \bm{x}\circ\bm{x})^\top (\bm{y} - \gamma_1 \bm{1}_n -  \gamma_2 \bm{x} - \gamma_3 \bm{x}\circ\bm{x})\bigg) \text{exp}\bigg(  -\frac{\gamma_1^2}{2} \bigg) d\gamma_1\\
=&amp; \int \text{exp} \bigg( -\frac{1}{2} \bigg(\bm{y}^\top\bm{y} + n\gamma_1^2 + \gamma_2^2 \bm{x}^\top\bm{x} + \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) \bigg)  \bigg)\\
&amp; \text{exp} \bigg(  \gamma_1\bm{1}_n^\top\bm{y} - \gamma_1 \gamma_2 \bm{1}_n^\top\bm{x} - \gamma_1 \gamma_3 \bm{1}_n^\top(\bm{x}\circ\bm{x}) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}) \bigg)\text{exp}\bigg(  -\frac{\gamma_1^2}{2} \bigg) d\gamma_1\\
=&amp; \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg)
\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\int \text{exp} \bigg( -\frac{n+1}{2} \gamma_1^2  + \bm{1}_n^\top(\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x})) \gamma_1 \bigg) d\gamma_1\\
=&amp; \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{exp}\bigg( \frac{1}{2}\frac{1}{n+1} (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))^\top \bm{1}_n\bm{1}_n^\top (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))  \bigg) \\
&amp;\int N\bigg( \gamma_1; \frac{1}{n+1}(\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x})),\frac{1}{n+1} \bigg) d\gamma_1\\
=&amp; \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{exp}\bigg( \frac{1}{2}\frac{1}{n+1} (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))^\top \bm{1}_n\bm{1}_n^\top (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))  \bigg) \\
=&amp; \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{exp}\bigg( \frac{1}{2}\frac{1}{n+1} \bm{y}^\top \bm{1}_n\bm{1}_n^\top \bm{y} + \frac{1}{2}\frac{1}{n+1}\gamma_2^2 \bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{x} + \frac{1}{2}\frac{1}{n+1}\gamma_3^2  (\bm{x}\circ\bm{x})^\top \bm{1}_n\bm{1}_n^\top (\bm{x}\circ\bm{x})  \bigg) \\
&amp; \text{exp}\bigg( -\frac{1}{n+1}\gamma_2 \bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{y} + \frac{1}{n+1}\gamma_2 \gamma_3 \bm{x}^\top \bm{1}_n\bm{1}_n^\top (\bm{x}\circ\bm{x}) - \frac{1}{n+1}\gamma_3 (\bm{x}\circ\bm{x})^\top \bm{1}_n\bm{1}_n^\top\bm{y} \bigg)\\
=&amp; \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top(\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top)\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top) (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top (\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top) \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top(\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top)\bm{x}\bigg) + \gamma_2 \bm{x}^\top(\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top)\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top)(\bm{x}\circ\bm{x}) \bigg) \\
=&amp; \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \gamma_2^2 \bm{x}^\top\bm{H}_n\bm{x} + \gamma_2 \bm{x}^\top\bm{H}_n\bm{y} - \gamma_2\gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top \\
\\
\text{Integrate out } \gamma_2 :&amp;\\
p(\bm{y}|\gamma_3) =&amp; \int p(y|\gamma_2,\gamma_3) p(\gamma_2) d \gamma_2 \\
=&amp; \int p(y|\gamma_2,\gamma_3) N(\gamma_2;1,1) d \gamma_2 \\
\propto&amp;  \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp; \int \text{exp}\bigg( -\frac{1}{2} \gamma_2^2 \bm{x}^\top\bm{H}_n\bm{x} + \gamma_2 \bm{x}^\top\bm{H}_n\bm{y} - \gamma_2\gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) \bigg) \text{exp}\bigg( -\frac{\gamma_2^2}{2} + \gamma_2\bigg) d \gamma_2 \\
=&amp;  \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp; \int \text{exp}\bigg( -\frac{1}{2} \gamma_2^2 (1+\bm{x}^\top\bm{H}_n\bm{x}) + \gamma_2 (1 + \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) ) \bigg) d \gamma_2 \\
\propto&amp;  \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp} \bigg(  \frac{1}{2} \frac{1}{(1+\bm{x}^\top\bm{H}_n\bm{x}) } (1 + \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )^\top (1 + \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )  \bigg) \\
&amp; \int N\bigg(\gamma_2; \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}(1 + \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) ), \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bigg) d \gamma_2 \\
=&amp;  \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp} \bigg(  \frac{1}{2} \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x} }
(1 + \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )^\top
(1 + \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )  \bigg) \\
=&amp;  \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp} \bigg( \frac{1}{2} \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x} }\bigg(
1 + \bm{y}^\top\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bm{y}   +
\gamma_3^2 (\bm{x}\circ\bm{x})^\top\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x})  \bigg)\bigg) \\
&amp;\text{exp} \bigg(\frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x} }\bigg(  
\bm{y}^\top\bm{H}_n^\top\bm{x} -
\gamma_3 \bm{y}^\top\bm{H}_n^\top\bm{x} \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) -
\gamma_3 (\bm{x}\circ\bm{x})^\top\bm{H}_n^\top\bm{x} -
\gamma_3 (\bm{x}\circ\bm{x})^\top\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bm{y}
\bigg)\bigg)\\
\propto&amp;  \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bigg(\bm{H}_n - \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x} }\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bigg)\bm{y} + \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bm{y}^\top\bm{H}_n^\top\bm{x} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2}
\gamma_3^2 (\bm{x}\circ\bm{x})^\top \bigg(\bm{H}_n - \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x} }\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bigg) (\bm{x}\circ\bm{x}) + \\
&amp;\gamma_3 (\bm{x}\circ\bm{x})^\top \bigg(\bm{H}_n - \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x} }\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bigg) \bm{y}
- \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\gamma_3 \bm{y}^\top\bm{H}_n^\top\bm{x} \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) - \\
&amp;\frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\gamma_3 (\bm{x}\circ\bm{x})^\top\bm{H}_n^\top\bm{x}
\bigg) \\
=&amp;  \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y} + \bm{y}^\top\bm{s} \bigg)
\text{exp} \bigg(  -\frac{1}{2}
\gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x}) +
\gamma_3 (\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\gamma_3 \bm{z}^\top\bm{y} - \gamma_3 (\bm{x}\circ\bm{x})^\top\bm{s}
\bigg) \\
&amp;\text{where } \bm{G}_n = \bm{H}_n - \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n \\
&amp;\text{where } \bm{z} = \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bm{H}_n^\top\bm{x} \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) \\
&amp;\text{where } \bm{s} = \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top\bm{x} \\
\\
\text{Integrate out } \gamma_3 :&amp;\\
p(\bm{y}|H_2) =&amp; \int p(\bm{y}|\gamma_3) p(\gamma_3) d \gamma_3 \\
=&amp; \int p(\bm{y}|\gamma_3) N(\gamma_3;0,1) d \gamma_3 \\
\propto&amp;  \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y} + \bm{y}^\top\bm{s} \bigg)  \\
&amp;\int \text{exp} \bigg(  -\frac{1}{2}
\gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x}) +
\gamma_3 (\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\gamma_3 \bm{z}^\top\bm{y} - \gamma_3 (\bm{x}\circ\bm{x})^\top\bm{s}
\bigg)
\text{exp} \bigg( -\frac{\gamma_3^2}{2}\bigg) d \gamma_3\\
=&amp;  \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y} + \bm{y}^\top\bm{s} \bigg)  \\
&amp;\int \text{exp} \bigg(  -\frac{1}{2}
\gamma_3^2 (1+(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})) +
\gamma_3 \bigg((\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\bm{z}^\top\bm{y} -  (\bm{x}\circ\bm{x})^\top\bm{s} \bigg)
\bigg) d \gamma_3\\
=&amp;  \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y} + \bm{y}^\top\bm{s} \bigg)  \\
&amp;\text{exp}\bigg( \frac{1}{2} \frac{1}{1+(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} \bigg((\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\bm{z}^\top\bm{y} -  (\bm{x}\circ\bm{x})^\top\bm{s} \bigg)^\top \bigg((\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\bm{z}^\top\bm{y} -  (\bm{x}\circ\bm{x})^\top\bm{s} \bigg)\bigg) \\
&amp;\int N\bigg( \gamma_3; \frac{1}{1+(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} \bigg((\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\bm{z}^\top\bm{y} -  (\bm{x}\circ\bm{x})^\top\bm{s} \bigg), \frac{1}{1+(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})}\bigg) d \gamma_3\\
=&amp;  \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y} + \bm{y}^\top\bm{s} \bigg)  \\
&amp;\text{exp}\bigg( \frac{1}{\bm{2d}} \bigg((\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\bm{z}^\top\bm{y} -  (\bm{x}\circ\bm{x})^\top\bm{s} \bigg)^\top
\bigg((\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} -
\bm{z}^\top\bm{y} -  
(\bm{x}\circ\bm{x})^\top\bm{s} \bigg)\bigg) \\
=&amp;  \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y} + \bm{y}^\top\bm{s} \bigg)  \\
&amp;\text{exp}\bigg( \frac{1}{\bm{2d}}\bigg( \bm{y}^\top \bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} +  \bm{y}^\top\bm{z}\bm{z}^\top\bm{y}  + \bm{s}^\top(\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top\bm{s} \bigg) \bigg) \\
&amp;\text{exp}\bigg( \frac{1}{\bm{d}}\bigg( - \bm{y}^\top \bm{z}(\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y} + \bm{y}^\top \bm{z}(\bm{x}\circ\bm{x})^\top\bm{s} -  \bm{y}^\top\bm{G}_n^\top(\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top\bm{s} \bigg)\bigg)\\
\propto&amp; \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bigg(\bm{G}_n -  \frac{1}{d}\bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n - \frac{1}{d}\bm{z}\bm{z}^\top + \frac{2}{d}\bm{z}(\bm{x}\circ\bm{x})^\top \bm{G}_n \bigg)\bm{y} \\
+&amp; \bm{y}^\top \bigg( \bm{s} + \frac{1}{\bm{d}}\bm{z}(\bm{x}\circ\bm{x})^\top\bm{s}  - \frac{1}{\bm{d}} \bm{G}_n^\top(\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top\bm{s}\bigg)\bigg)\\
\\
\bm{y}|H_2 \sim&amp; MN \bigg(\bm{A}^{-1}\bm{b}, \bm{A}^{-1}\bigg) \\
\\
&amp;\text{where } \bm{d} = 1+(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})\\
&amp;\text{where } \bm{A} = \bm{G}_n -  \frac{1}{d}\bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n - \frac{1}{d}\bm{z}\bm{z}^\top + \frac{2}{d}\bm{z}(\bm{x}\circ\bm{x})^\top \bm{G}_n \\
&amp;\text{where } \bm{b} = \bm{s} + \frac{1}{\bm{d}}\bm{z}(\bm{x}\circ\bm{x})^\top\bm{s}  - \frac{1}{\bm{d}} \bm{G}_n^\top(\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top\bm{s}\\
\end{align*}</span>
<div style="page-break-after: always;"></div>
</section>
<section id="question-3.3-8-points" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="question-3.3-8-points"><span class="header-section-number">3.3</span> Question 3.3 (8 points)</h2>
<p>Write down the Bayes factor <span class="math inline">B = f(y_1,\dots,y_n|H_2)/f(y_1,\dots,y_n|H_1)</span> for comparing the two models and evaluate it for the given data set.</p>
<span class="math display">\begin{align*}
\bm{y}|H_1 \sim&amp; MN \bigg(\bm{C}^{-1}\bm{u},  \bm{C}^{-1}  \bigg) \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top \\
&amp;\text{where } \bm{C} = \bm{H}_n - \frac{\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n}{1+\bm{x}^\top\bm{H}_n\bm{x}} \\
&amp;\text{where } \bm{u} = \frac{\bm{H}_n^\top\bm{x}}{1+\bm{x}^\top\bm{H}_n\bm{x}} \\
\\
\bm{y}|H_2 \sim&amp; MN \bigg(\bm{A}^{-1}\bm{b}, \bm{A}^{-1}\bigg) \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n+1}\bm{1}_n\bm{1}_n^\top \\
&amp;\text{where } \bm{G}_n = \bm{H}_n - \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n \\
&amp;\text{where } \bm{z} = \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}}\bm{H}_n^\top\bm{x} \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) \\
&amp;\text{where } \bm{s} = \frac{1}{1+\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top\bm{x} \\
&amp;\text{where } \bm{d} = 1+(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})\\
&amp;\text{where } \bm{A} = \bm{G}_n -  \frac{1}{d}\bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n - \frac{1}{d}\bm{z}\bm{z}^\top + \frac{2}{d}\bm{z}(\bm{x}\circ\bm{x})^\top \bm{G}_n \\
&amp;\text{where } \bm{b} = \bm{s} + \frac{1}{\bm{d}}\bm{z}(\bm{x}\circ\bm{x})^\top\bm{s}  - \frac{1}{\bm{d}} \bm{G}_n^\top(\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top\bm{s}\\
\\
\\
B =&amp; \frac{(2\pi)^{-\frac{n}{2}} |\bm{A}|^{1/2} \text{exp}\bigg( -\frac{1}{2} (\bm{y} - \bm{A}^{-1}\bm{b})^\top\bm{A} (\bm{y} - \bm{A}^{-1}\bm{b})\bigg) }{(2\pi)^{-\frac{n}{2}} |\bm{C}|^{1/2} \text{exp}\bigg( -\frac{1}{2} (\bm{y} - \bm{C}^{-1}\bm{u})^\top\bm{C} (\bm{y} - \bm{C}^{-1}\bm{u})\bigg)} \\
=&amp; \frac{ |\bm{A}|^{1/2} \text{exp}\bigg( -\frac{1}{2} (\bm{y} - \bm{A}^{-1}\bm{b})^\top\bm{A} (\bm{y} - \bm{A}^{-1}\bm{b})\bigg) }{ |\bm{C}|^{1/2} \text{exp}\bigg( -\frac{1}{2} (\bm{y} - \bm{C}^{-1}\bm{u})^\top\bm{C} (\bm{y} - \bm{C}^{-1}\bm{u})\bigg)} \\
\end{align*}</span>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.9</span> , <span class="sc">-</span><span class="fl">0.39</span> , <span class="fl">0.79</span> , <span class="sc">-</span><span class="fl">0.20</span> , <span class="fl">0.42</span> , <span class="sc">-</span><span class="fl">0.35</span> , <span class="fl">0.67</span> , <span class="fl">0.63</span> , <span class="sc">-</span><span class="fl">0.024</span> , <span class="fl">1.2</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.7</span> ,<span class="sc">-</span><span class="fl">0.23</span> , <span class="fl">0.50</span> , <span class="sc">-</span><span class="fl">0.66</span> , <span class="fl">1.97</span> , <span class="fl">0.10</span> , <span class="fl">0.60</span> , <span class="fl">1.13</span> , <span class="sc">-</span><span class="fl">0.943</span> , <span class="fl">2.6</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># data summary and calc needed for BF</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>one <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,n)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">diag</span>(n)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># H1 stats</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>Hn1 <span class="ot">&lt;-</span> I <span class="sc">-</span> (<span class="dv">1</span><span class="sc">/</span>(n<span class="sc">+</span><span class="dv">1</span>)) <span class="sc">*</span>one <span class="sc">%*%</span> <span class="fu">t</span>(one)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> Hn1 <span class="sc">-</span> (<span class="fu">t</span>(Hn1) <span class="sc">%*%</span> x <span class="sc">%*%</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> Hn1)<span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> Hn1 <span class="sc">%*%</span> x)[<span class="dv">1</span>]</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> (<span class="fu">t</span>(Hn1) <span class="sc">%*%</span> x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> Hn1 <span class="sc">%*%</span> x)[<span class="dv">1</span>]</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># H2 stats</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>Hn2 <span class="ot">&lt;-</span> I <span class="sc">-</span> (<span class="dv">1</span><span class="sc">/</span>(n<span class="sc">+</span><span class="dv">1</span>)) <span class="sc">*</span>one <span class="sc">%*%</span> <span class="fu">t</span>(one)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> Hn2 <span class="sc">-</span> (<span class="fu">t</span>(Hn2) <span class="sc">%*%</span> x <span class="sc">%*%</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> Hn2) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">t</span>(x)  <span class="sc">%*%</span> Hn2 <span class="sc">%*%</span> x)[<span class="dv">1</span>]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> (<span class="fu">t</span>(Hn2) <span class="sc">%*%</span> x <span class="sc">%*%</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> Hn2 <span class="sc">%*%</span> x2) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">t</span>(x)  <span class="sc">%*%</span> Hn2 <span class="sc">%*%</span> x)[<span class="dv">1</span>]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> (<span class="fu">t</span>(Hn2) <span class="sc">%*%</span> x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">t</span>(x)  <span class="sc">%*%</span> Hn2 <span class="sc">%*%</span> x)[<span class="dv">1</span>]</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">t</span>(x2) <span class="sc">%*%</span> G <span class="sc">%*%</span> x2)[<span class="dv">1</span>]</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> G <span class="sc">-</span> (<span class="fu">t</span>(G) <span class="sc">%*%</span> x2 <span class="sc">%*%</span> <span class="fu">t</span>(x2) <span class="sc">%*%</span> G)<span class="sc">/</span>d <span class="sc">-</span> (z <span class="sc">%*%</span> <span class="fu">t</span>(z))<span class="sc">/</span>d <span class="sc">+</span> (<span class="dv">2</span><span class="sc">/</span>d)<span class="sc">*</span> (z <span class="sc">%*%</span> <span class="fu">t</span>(x2) <span class="sc">%*%</span> G)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> s <span class="sc">+</span> (z <span class="sc">%*%</span> <span class="fu">t</span>(x2) <span class="sc">%*%</span> s)<span class="sc">/</span>d <span class="sc">-</span> (<span class="fu">t</span>(G) <span class="sc">%*%</span> x2 <span class="sc">%*%</span> <span class="fu">t</span>(x2) <span class="sc">%*%</span> s ) <span class="sc">/</span> d</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># bayesfactor</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> (<span class="fu">det</span>(A)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">t</span>(y <span class="sc">-</span> <span class="fu">solve</span>(A) <span class="sc">%*%</span> b) <span class="sc">%*%</span> A <span class="sc">%*%</span> (y <span class="sc">-</span> <span class="fu">solve</span>(A) <span class="sc">%*%</span> b))[<span class="dv">1</span>]) <span class="sc">/</span> </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">det</span>(C)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">t</span>(y <span class="sc">-</span> <span class="fu">solve</span>(C) <span class="sc">%*%</span> u) <span class="sc">%*%</span> C <span class="sc">%*%</span> (y <span class="sc">-</span> <span class="fu">solve</span>(C) <span class="sc">%*%</span> u))[<span class="dv">1</span>])</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"B = "</span>,<span class="fu">round</span>(B,<span class="dv">5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "B =  0.42017"</code></pre>
</div>
</div>
<p>The calculated Bayes Factor is 0.42017 this indicates that model 1 <span class="math inline">H_1</span> may be a better model for the data.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="question-3.4-10-points" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="question-3.4-10-points"><span class="header-section-number">3.4</span> Question 3.4 (10 points)</h2>
<p>We now replace the prior distribution by improper constant priors: <span class="math inline">\pi(\beta_1) = \pi(\beta_2) = c_1</span> in model <span class="math inline">H_1</span> and <span class="math inline">\pi(\gamma_1) = \pi(\gamma_2) = \pi(\gamma_3) = c_2</span> in model <span class="math inline">H_2</span>. We can still obtain the marginal distributions and define a Bayes factor. Show that the value of the Bayes factor depends on both <span class="math inline">c_1</span> and <span class="math inline">c_2</span>.</p>
<span class="math display">\begin{align*}
\pi(y_1,\dots,y_n|H_1) =&amp; \int f(y_1,\dots, y_n|\beta_1,\beta_2)\pi(\beta_1)\pi(\beta_2)d\beta_1 d\beta_2\\
\text{Integrate out } \beta_1 :&amp;\\
p(\bm{y}|\beta_2)  =&amp; \int f(y_1,\dots, y_n|\beta_1,\beta_2)\pi(\beta_1)d\beta_1 \\
=&amp; \int N(y_1,\dots, y_n;\beta_1 1_n + \bm{x}\beta_2,I_n) c_1 d\beta_1\\
=&amp; c_1 \int (2\pi)^{-\frac{n}{2}}\text{exp}\bigg( -\frac{1}{2}(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2)^\top(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2) \bigg) d \beta_1 \\
=&amp; c_1 (2\pi)^{-\frac{n}{2}}\int \text{exp}\bigg( -\frac{1}{2}(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2)^\top(\bm{y} - \beta_1 \bm{1}_n - \bm{x}\beta_2) \bigg)  d \beta_1 \\
=&amp; c_1 (2\pi)^{-\frac{n}{2}}\int \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top - n\beta_1^2 - \beta_2^2\bm{x}^\top\bm{x}\bigg)\text{exp}\bigg( \beta_1\bm{1}_n^\top\bm{y} - \beta_1\beta_2 \bm{1}_n^\top\bm{x} - \beta_2\bm{x}^\top\bm{y} \bigg)  d \beta_1 \\
=&amp; c_1 (2\pi)^{-\frac{n}{2}} \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top)\bigg)\text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{x} +   \beta_2\bm{x}^\top\bm{y} \bigg) \int \text{exp}\bigg( -\frac{n}{2}\beta_1^2 + \bigg(\bm{1}_n^\top\bm{y} - \beta_2 \bm{1}_n^\top\bm{x}\bigg)\beta_1 \bigg) d\beta_1 \\
\propto&amp; c_1  \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top)\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{x} +   \beta_2\bm{x}^\top\bm{y} \bigg)  \\
&amp;\text{exp} \bigg( \frac{1}{2n} (\bm{y} - \beta_2\bm{x})^\top\bm{1}_n\bm{1}_n^\top(\bm{y} - \beta_2\bm{x})\bigg) \int N\bigg( \beta_1; \frac{1}{n}\bigg(\bm{1}_n^\top\bm{y} - \beta_2 \bm{1}_n^\top\bm{x}\bigg), \frac{1}{n}\bigg) d\beta_1 \\
=&amp; c_1  \text{exp}\bigg( -\frac{1}{2}(\bm{y}\bm{y}^\top)\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{x} +   \beta_2\bm{x}^\top\bm{y} \bigg)  \\
&amp;\text{exp} \bigg(   \frac{1}{2n}\bm{y}^\top\bm{1}_n\bm{1}_n^\top\bm{y} +  \frac{1}{2n} \beta_2^2\bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{x} - \frac{1}{n} \beta_2\bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{y} \bigg) \\
=&amp; c_1  \text{exp}\bigg( -\frac{1}{2}\bm{y}(\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top)\bm{y}^\top\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top(\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top)\bm{x} +   \beta_2\bm{x}^\top(\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top)\bm{y} \bigg)  \\
=&amp; c_1 \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{H}_n\bm{x} +   \beta_2\bm{x}^\top\bm{H}_n\bm{y} \bigg)  \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top \\
\\
\text{Integrate out } \beta_2 :&amp;\\
p(\bm{y}|H_1) =&amp; \int p(\bm{y}|\beta_2) p(\beta_2)d\beta_2  \\
=&amp; \int p(\bm{y}|\beta_2) c_1 d\beta_2  \\
\propto&amp; \int  c_1^2\text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{H}_n\bm{x} +   \beta_2\bm{x}^\top\bm{H}_n\bm{y} \bigg) d \beta_2 \\
=&amp; c_1^2 \text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \int   \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{H}_n\bm{x} +   \beta_2\bm{x}^\top\bm{H}_n\bm{y} \bigg) d \beta_2 \\
=&amp; c_1^2\text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg) \int   \text{exp}\bigg( -\frac{1}{2} \beta_2^2\bm{x}^\top\bm{H}_n\bm{x} +   \beta_2\bm{x}^\top\bm{H}_n\bm{y} \bigg) d \beta_2 \\
=&amp; c_1^2\text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bm{H}_n\bm{y}\bigg)  \text{exp}\bigg( \frac{1}{2}\frac{\bm{y}^\top\bm{H}_n^\top \bm{x} \bm{x}^\top\bm{H}_n\bm{y}}{\bm{x}^\top\bm{H}_n\bm{x}} \bigg) \int N\bigg(\beta_2; \frac{ \bm{x}^\top\bm{H}_n\bm{y}}{\bm{x}^\top\bm{H}_n\bm{x}},\frac{1}{\bm{x}^\top\bm{H}_n\bm{x}} \bigg) d \beta_2 \\
\\
\propto&amp;c_1^2\text{exp}\bigg( -\frac{1}{2}\bm{y}^\top\bigg(\bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top \bm{x} \bm{x}^\top\bm{H}_n \bigg)\bm{y}\bigg)\\
=&amp; c_1^2\text{exp}\bigg( -\frac{1}{2}\bm{y}^\top \bm{C}\bm{y}\bigg)\\
\\
\bm{y}|H_1 \sim&amp; c_1^2 MN \bigg(\bm{0}_n,  \bm{C}^{-1}  \bigg) \\
&amp;\text{where } \bm{C} = \bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top \bm{x} \bm{x}^\top\bm{H}_n \\
\end{align*}</span>
<span class="math display">\begin{align*}
\pi(y_1,\dots,y_n|H_2) =&amp; \int f(y_1,\dots, y_n|\gamma_1,\gamma_2,\gamma_3)\pi(\gamma_1)\pi(\gamma_2)\pi(\gamma_3)d\gamma_1 d\gamma_2 d\gamma_3 \\
\text{Integrate out }\gamma_1:&amp;\\
p(\bm{y}|\gamma_2,\gamma_3) =&amp; \int f(y_1,\dots, y_n|\gamma_1,\gamma_2,\gamma_3)\pi(\gamma_1) d \gamma_1 \\
=&amp; \int N (\bm{y}; \gamma_1 \bm{1}_n +  \gamma_2 \bm{x} + \gamma_3 \bm{x}\circ\bm{x},\bm{I}_n ) c_2 d \gamma_1  \\
\propto&amp; \int c_2\text{exp} \bigg( -\frac{1}{2} (\bm{y} - \gamma_1 \bm{1}_n -  \gamma_2 \bm{x} - \gamma_3 \bm{x}\circ\bm{x})^\top (\bm{y} - \gamma_1 \bm{1}_n -  \gamma_2 \bm{x} - \gamma_3 \bm{x}\circ\bm{x})\bigg)  d\gamma_1\\
=&amp; c_2 \int \text{exp} \bigg( -\frac{1}{2} \bigg(\bm{y}^\top\bm{y} + n\gamma_1^2 + \gamma_2^2 \bm{x}^\top\bm{x} + \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) \bigg)  \bigg)\\
&amp; \text{exp} \bigg(  \gamma_1\bm{1}_n^\top\bm{y} - \gamma_1 \gamma_2 \bm{1}_n^\top\bm{x} - \gamma_1 \gamma_3 \bm{1}_n^\top(\bm{x}\circ\bm{x}) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}) \bigg) d\gamma_1\\
=&amp; c_2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg)
\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\int \text{exp} \bigg( -\frac{n}{2} \gamma_1^2  + \bm{1}_n^\top(\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x})) \gamma_1 \bigg) d\gamma_1\\
=&amp; c_2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{exp}\bigg( \frac{1}{2}\frac{1}{n} (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))^\top \bm{1}_n\bm{1}_n^\top (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))  \bigg) \\
&amp;\int N\bigg( \gamma_1; \frac{1}{n}(\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x})),\frac{1}{n} \bigg) d\gamma_1\\
=&amp; c_2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{exp}\bigg( \frac{1}{2n} (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))^\top \bm{1}_n\bm{1}_n^\top (\bm{y} - \gamma_2 \bm{x} -  \gamma_3 (\bm{x}\circ\bm{x}))  \bigg) \\
=&amp; c_2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top\bm{x}\bigg) + \gamma_2 \bm{x}^\top\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{exp}\bigg( \frac{1}{2n} \bm{y}^\top \bm{1}_n\bm{1}_n^\top \bm{y} + \frac{1}{2n}\gamma_2^2 \bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{x} + \frac{1}{2n}\gamma_3^2  (\bm{x}\circ\bm{x})^\top \bm{1}_n\bm{1}_n^\top (\bm{x}\circ\bm{x})  \bigg) \\
&amp; \text{exp}\bigg( -\frac{1}{n}\gamma_2 \bm{x}^\top\bm{1}_n\bm{1}_n^\top\bm{y} + \frac{1}{n}\gamma_2 \gamma_3 \bm{x}^\top \bm{1}_n\bm{1}_n^\top (\bm{x}\circ\bm{x}) - \frac{1}{n}\gamma_3 (\bm{x}\circ\bm{x})^\top \bm{1}_n\bm{1}_n^\top\bm{y} \bigg)\\
=&amp; c_2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top(\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top)\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top (\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top) (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top (\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top) \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \bigg(\gamma_2^2 \bm{x}^\top(\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top)\bm{x}\bigg) + \gamma_2 \bm{x}^\top(\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top)\bm{y} - \gamma_2\gamma_3 \bm{x}^\top(\bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top)(\bm{x}\circ\bm{x}) \bigg) \\
=&amp; c_2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp}\bigg( -\frac{1}{2} \gamma_2^2 \bm{x}^\top\bm{H}_n\bm{x} + \gamma_2 \bm{x}^\top\bm{H}_n\bm{y} - \gamma_2\gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) \bigg) \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top \\
\\
\text{Integrate out } \gamma_2 :&amp;\\
p(\bm{y}|\gamma_3) =&amp; \int p(y|\gamma_2,\gamma_3) p(\gamma_2) d \gamma_2 \\
=&amp; \int p(y|\gamma_2,\gamma_3) c_2 d \gamma_2 \\
\propto&amp;  c_2^2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp; \int \text{exp}\bigg( -\frac{1}{2} \gamma_2^2 \bm{x}^\top\bm{H}_n\bm{x} + \gamma_2 \bm{x}^\top\bm{H}_n\bm{y} - \gamma_2\gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) \bigg) d \gamma_2 \\
=&amp; c_2^2  \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp; \int \text{exp}\bigg( -\frac{1}{2} \gamma_2^2 \bm{x}^\top\bm{H}_n\bm{x} + \gamma_2 (\bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) ) \bigg) d \gamma_2 \\
=&amp;  c_2^2\text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp} \bigg(  \frac{1}{2} \frac{1}{\bm{x}^\top\bm{H}_n\bm{x} } ( \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )^\top (\bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )  \bigg) \\
&amp; \int N\bigg(\gamma_2; \frac{1}{\bm{x}^\top\bm{H}_n\bm{x}}( \bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) ), \frac{1}{\bm{x}^\top\bm{H}_n\bm{x}}\bigg) d \gamma_2 \\
=&amp; c_2^2 \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp} \bigg(  \frac{1}{2} \frac{1}{\bm{x}^\top\bm{H}_n\bm{x} }
(\bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )^\top
(\bm{x}^\top\bm{H}_n\bm{y} - \gamma_3 \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x}) )  \bigg) \\
=&amp; c_2^2 \text{exp} \bigg(  -\frac{1}{2} \bm{y}^\top\bm{H}_n\bm{y} \bigg) \text{exp} \bigg(  -\frac{1}{2} \gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{H}_n (\bm{x}\circ\bm{x}) + \gamma_3 (\bm{x}\circ\bm{x})^\top \bm{H}_n \bm{y}\bigg) \\
&amp;\text{exp} \bigg( \frac{1}{2} \frac{1}{\bm{x}^\top\bm{H}_n\bm{x} }\bigg(
\bm{y}^\top\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bm{y}   +
\gamma_3^2 (\bm{x}\circ\bm{x})^\top\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x})  \bigg)\bigg) \\
&amp;\text{exp} \bigg(\frac{1}{\bm{x}^\top\bm{H}_n\bm{x} }\bigg(   -
\gamma_3 \bm{y}^\top\bm{H}_n^\top\bm{x} \bm{x}^\top\bm{H}_n(\bm{x}\circ\bm{x})
\bigg)\bigg)\\
\propto&amp;  c_2^2\text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bigg(\bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x} }\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bigg)\bm{y} \bigg) \\
&amp;\text{exp} \bigg(  -\frac{1}{2}
\gamma_3^2 (\bm{x}\circ\bm{x})^\top \bigg(\bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x} }\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bigg) (\bm{x}\circ\bm{x})  \\
+&amp;\gamma_3 \bm{y}^\top \bigg(\bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x} }\bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n\bigg)^\top (\bm{x}\circ\bm{x})
\bigg) \\
\\
=&amp;  c_2^2 \text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y} \bigg)
\text{exp} \bigg(  -\frac{1}{2}
\gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x}) +
\gamma_3 (\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y}
\bigg) \\
&amp;\text{where } \bm{G}_n = \bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n \\
\\
\text{Integrate out } \gamma_3 :&amp;\\
p(\bm{y}|H_2) =&amp; \int p(\bm{y}|\gamma_3) p(\gamma_3) d \gamma_3 \\
=&amp; \int p(\bm{y}|\gamma_3) c_2 d \gamma_3 \\
\propto&amp;  c_2^3\text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y}  \bigg)  
\int \text{exp} \bigg(  -\frac{1}{2}
\gamma_3^2 (\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x}) +
\gamma_3 (\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y}
\bigg) d \gamma_3\\
\propto&amp;  c_2^3\text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{G}_n\bm{y}  \bigg)  
\text{exp} \bigg( \frac{1}{2}\frac{1}{(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} \bm{y}^\top \bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y}\bigg)\\
&amp;\int N\bigg(\gamma_3;  \frac{1}{(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} (\bm{x}\circ\bm{x})^\top \bm{G}_n \bm{y},\frac{1}{(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} \bigg) d \gamma_3\\
=&amp;  c_2^3\text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bigg(\bm{G}_n - \frac{1}{(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} \bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n \bigg)\bm{y}  \bigg)  \\
=&amp;  c_2^3\text{exp} \bigg(  -\frac{1}{2}
\bm{y}^\top\bm{A}\bm{y}  \bigg)  
\\
\bm{y}|H_2 \sim&amp; c_2^3MN \bigg(\bm{0}, \bm{A}^{-1}\bigg) \\
&amp;\text{where } \bm{A} = \bm{G}_n - \frac{1}{(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} \bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n \\
\end{align*}</span>
<span class="math display">\begin{align*}
\text{Model 1 with improper constant prior } c_1:&amp;\\
\bm{y}|H_1 \sim&amp; c_1^2 MN \bigg(\bm{0}_n,  \bm{C}^{-1}  \bigg) \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top \\
&amp;\text{where } \bm{C} = \bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top \bm{x} \bm{x}^\top\bm{H}_n \\
\\
\text{Model 2 with improper constant prior } c_2:&amp;\\
\bm{y}|H_2 \sim&amp; c_2^3MN \bigg(\bm{0}, \bm{A}^{-1}\bigg) \\
&amp;\text{where } \bm{H}_n = \bm{I}_n - \frac{1}{n}\bm{1}_n\bm{1}_n^\top \\
&amp;\text{where } \bm{G}_n = \bm{H}_n - \frac{1}{\bm{x}^\top\bm{H}_n\bm{x}} \bm{H}_n^\top\bm{x}\bm{x}^\top\bm{H}_n \\
&amp;\text{where } \bm{A} = \bm{G}_n - \frac{1}{(\bm{x}\circ\bm{x})^\top \bm{G}_n (\bm{x}\circ\bm{x})} \bm{G}_n^\top (\bm{x}\circ\bm{x})(\bm{x}\circ\bm{x})^\top \bm{G}_n \\
\\
\text{Bayes Factor:}&amp;\\
B =&amp; \frac{c_2^3(2\pi)^{-\frac{n}{2}} |\bm{A}|^{1/2} \text{exp}\bigg( -\frac{1}{2} \bm{y}^\top\bm{A} \bm{y} \bigg) }{c_1^2(2\pi)^{-\frac{n}{2}} |\bm{C}|^{1/2} \text{exp}\bigg( -\frac{1}{2} \bm{y}^\top \bm{C} \bm{y}\bigg)} \\
=&amp; \frac{c_2^3}{c_1^2}\cdot\frac{ |\bm{A}|^{1/2} \text{exp}\bigg( -\frac{1}{2} \bm{y}^\top\bm{A} \bm{y} \bigg) }{ |\bm{C}|^{1/2} \text{exp}\bigg( -\frac{1}{2} \bm{y}^\top \bm{C} \bm{y}\bigg)} \\
\end{align*}</span>
<p>From the Bayes Factor we can see that it depends on the values of <span class="math inline">c_1</span> and <span class="math inline">c_2</span>.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
